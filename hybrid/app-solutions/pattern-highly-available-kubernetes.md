---
title: Modello di Kubernetes a disponibilità elevata con Azure e l'hub di Azure Stack
description: Informazioni su una soluzione di cluster Kubernetes che offre disponibilità elevata usando Azure e l'hub di Azure Stack.
author: BryanLa
ms.topic: article
ms.date: 12/03/2020
ms.author: bryanla
ms.reviewer: bryanla
ms.lastreviewed: 12/03/2020
ms.openlocfilehash: 454cc0a0531882b7a8ec050a461420ce13eebcfe
ms.sourcegitcommit: df7e3e6423c3d4e8a42dae3d1acfba1d55057258
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 12/09/2020
ms.locfileid: "96912002"
---
# <a name="high-availability-kubernetes-cluster-pattern"></a><span data-ttu-id="d07c2-103">Modello di cluster Kubernetes a disponibilità elevata</span><span class="sxs-lookup"><span data-stu-id="d07c2-103">High availability Kubernetes cluster pattern</span></span>

<span data-ttu-id="d07c2-104">Questo articolo descrive come progettare e gestire un'infrastruttura a disponibilità elevata basata su Kubernetes usando il motore del servizio Azure Kubernetes nell'hub di Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="d07c2-104">This article describes how to architect and operate a highly available Kubernetes-based infrastructure using Azure Kubernetes Service (AKS) Engine on Azure Stack Hub.</span></span> <span data-ttu-id="d07c2-105">Questo scenario è comune per le organizzazioni con carichi di lavoro cruciali in ambienti con restrizioni e altamente regolamentati,</span><span class="sxs-lookup"><span data-stu-id="d07c2-105">This scenario is common for organizations with critical workloads in highly restricted and regulated environments.</span></span> <span data-ttu-id="d07c2-106">ad esempio in domini come finanze, difesa e pubblica amministrazione.</span><span class="sxs-lookup"><span data-stu-id="d07c2-106">Organizations in domains such as finance, defense, and government.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="d07c2-107">Contesto e problema</span><span class="sxs-lookup"><span data-stu-id="d07c2-107">Context and problem</span></span>

<span data-ttu-id="d07c2-108">Molte organizzazioni sviluppano soluzioni native del cloud che sfruttano servizi e tecnologie all'avanguardia come Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="d07c2-108">Many organizations are developing cloud-native solutions that leverage state-of-the-art services and technologies like Kubernetes.</span></span> <span data-ttu-id="d07c2-109">Anche se per Azure sono disponibili data center nella maggior parte delle aree geografiche del mondo, a volte casi d'uso e scenari limite impongono l'esecuzione di applicazioni business critical in una specifica località.</span><span class="sxs-lookup"><span data-stu-id="d07c2-109">Although Azure provides datacenters in most regions of the world, sometimes there are edge use-cases and scenarios where business critical applications must run in a specific location.</span></span> <span data-ttu-id="d07c2-110">Ecco gli aspetti da considerare:</span><span class="sxs-lookup"><span data-stu-id="d07c2-110">Considerations include:</span></span>

- <span data-ttu-id="d07c2-111">Restrizioni per la località</span><span class="sxs-lookup"><span data-stu-id="d07c2-111">Location sensitivity</span></span>
- <span data-ttu-id="d07c2-112">Latenza tra l'applicazione e i sistemi locali</span><span class="sxs-lookup"><span data-stu-id="d07c2-112">Latency between the application and on-premises systems</span></span>
- <span data-ttu-id="d07c2-113">Conservazione della larghezza di banda</span><span class="sxs-lookup"><span data-stu-id="d07c2-113">Bandwidth conservation</span></span>
- <span data-ttu-id="d07c2-114">Connettività</span><span class="sxs-lookup"><span data-stu-id="d07c2-114">Connectivity</span></span>
- <span data-ttu-id="d07c2-115">Requisiti normativi o di legge</span><span class="sxs-lookup"><span data-stu-id="d07c2-115">Regulatory or statutory requirements</span></span>

<span data-ttu-id="d07c2-116">Azure, in combinazione con l'hub di Azure Stack, risolve la maggior parte di questi aspetti.</span><span class="sxs-lookup"><span data-stu-id="d07c2-116">Azure, in combination with Azure Stack Hub, addresses most of these concerns.</span></span> <span data-ttu-id="d07c2-117">Di seguito è riportato un ampio set di opzioni, decisioni e considerazioni per il successo di un'implementazione di Kubernetes in esecuzione nell'hub di Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="d07c2-117">A broad set of options, decisions, and considerations for a successful implementation of Kubernetes running on Azure Stack Hub is described below.</span></span>

## <a name="solution"></a><span data-ttu-id="d07c2-118">Soluzione</span><span class="sxs-lookup"><span data-stu-id="d07c2-118">Solution</span></span>

<span data-ttu-id="d07c2-119">Questo modello presuppone che sia necessario far fronte a un set rigoroso di vincoli.</span><span class="sxs-lookup"><span data-stu-id="d07c2-119">This pattern assumes that we have to deal with a strict set of constraints.</span></span> <span data-ttu-id="d07c2-120">L'applicazione deve essere eseguita in locale e i dati personali non devono essere spostati in servizi cloud pubblici.</span><span class="sxs-lookup"><span data-stu-id="d07c2-120">The application must run on-premises and all personal data must not reach public cloud services.</span></span> <span data-ttu-id="d07c2-121">I dati di monitoraggio e altre informazioni non personali possono essere inviati ad Azure per l'elaborazione.</span><span class="sxs-lookup"><span data-stu-id="d07c2-121">Monitoring and other non-PII data can be sent to Azure and be processed there.</span></span> <span data-ttu-id="d07c2-122">Servizi esterni come un registro contenitori pubblico o di altro tipo possono essere accessibili ma potrebbero essere filtrati tramite un firewall o un server proxy.</span><span class="sxs-lookup"><span data-stu-id="d07c2-122">External services like a public Container Registry or others can be accessed but might be filtered through a firewall or proxy server.</span></span>

<span data-ttu-id="d07c2-123">L'applicazione di esempio mostrata qui (basata sul [workshop per il servizio Azure Kubernetes](/learn/modules/aks-workshop/)) è progettata per usare soluzioni native di Kubernetes laddove possibile.</span><span class="sxs-lookup"><span data-stu-id="d07c2-123">The sample application shown here (based on [Azure Kubernetes Service Workshop](/learn/modules/aks-workshop/)) is designed to use Kubernetes-native solutions whenever possible.</span></span> <span data-ttu-id="d07c2-124">La scelta di usare servizi nativi della piattaforma evita la dipendenza da un singolo fornitore.</span><span class="sxs-lookup"><span data-stu-id="d07c2-124">This design avoids vendor lock-in, instead of using platform-native services.</span></span> <span data-ttu-id="d07c2-125">Ad esempio, l'applicazione usa un back-end di database MongoDB self-hosted invece di un servizio PaaS o di un servizio di database esterno.</span><span class="sxs-lookup"><span data-stu-id="d07c2-125">As an example, the application uses a self-hosted MongoDB database backend instead of a PaaS service or external database service.</span></span>

<span data-ttu-id="d07c2-126">[![Modello di applicazione ibrido](media/pattern-highly-available-kubernetes/application-architecture.png)](media/pattern-highly-available-kubernetes/application-architecture.png#lightbox)</span><span class="sxs-lookup"><span data-stu-id="d07c2-126">[![Application Pattern Hybrid](media/pattern-highly-available-kubernetes/application-architecture.png)](media/pattern-highly-available-kubernetes/application-architecture.png#lightbox)</span></span>

<span data-ttu-id="d07c2-127">Il diagramma precedente illustra l'architettura dell'applicazione di esempio in esecuzione in Kubernetes nell'hub di Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="d07c2-127">The preceding diagram illustrates the application architecture of the sample application running on Kubernetes on Azure Stack Hub.</span></span> <span data-ttu-id="d07c2-128">L'app è costituita da diversi componenti:</span><span class="sxs-lookup"><span data-stu-id="d07c2-128">The app consists of several components, including:</span></span>

 1) <span data-ttu-id="d07c2-129">Un cluster Kubernetes basato sul motore del servizio Azure Kubernetes nell'hub di Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="d07c2-129">An AKS Engine based Kubernetes cluster on Azure Stack Hub.</span></span>
 2) <span data-ttu-id="d07c2-130">[cert-manager](https://www.jetstack.io/cert-manager/), che include una serie di strumenti per la gestione dei certificati in Kubernetes, usati per richiedere automaticamente i certificati a Let's Encrypt.</span><span class="sxs-lookup"><span data-stu-id="d07c2-130">[cert-manager](https://www.jetstack.io/cert-manager/), which provides a suite of tools for certificate management in Kubernetes, used to automatically request certificates from Let's Encrypt.</span></span>
 3) <span data-ttu-id="d07c2-131">Uno spazio dei nomi di Kubernetes che contiene i componenti dell'applicazione per front-end (ratings-web), API (ratings-api) e database (ratings-mongodb).</span><span class="sxs-lookup"><span data-stu-id="d07c2-131">A Kubernetes namespace that contains the application components for the front end (ratings-web), api (ratings-api), and database (ratings-mongodb).</span></span>
 4) <span data-ttu-id="d07c2-132">Il controller in ingresso che instrada il traffico HTTP/HTTPS agli endpoint all'interno del cluster Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="d07c2-132">The Ingress Controller that routes HTTP/HTTPS traffic to endpoints within the Kubernetes cluster.</span></span>

<span data-ttu-id="d07c2-133">L'applicazione di esempio viene usata per illustrare questa architettura.</span><span class="sxs-lookup"><span data-stu-id="d07c2-133">The sample application is used to illustrate the application architecture.</span></span> <span data-ttu-id="d07c2-134">Tutti i componenti sono esempi.</span><span class="sxs-lookup"><span data-stu-id="d07c2-134">All components are examples.</span></span> <span data-ttu-id="d07c2-135">L'architettura contiene solo la distribuzione di una singola applicazione.</span><span class="sxs-lookup"><span data-stu-id="d07c2-135">The architecture contains only a single application deployment.</span></span> <span data-ttu-id="d07c2-136">Ai fini della disponibilità elevata, la distribuzione verrà eseguita almeno due volte in due istanze diverse dell'hub di Azure Stack, che possono essere eseguite nella stessa posizione oppure in due o più siti diversi:</span><span class="sxs-lookup"><span data-stu-id="d07c2-136">To achieve high availability (HA), we'll run the deployment at least twice on two different Azure Stack Hub instances - they can run either in the same location or in two (or more) different sites:</span></span>

![Architettura dell'infrastruttura](media/pattern-highly-available-kubernetes/aks-azure-architecture.png)

<span data-ttu-id="d07c2-138">Servizi come Registro Azure Container, Monitoraggio di Azure e altri sono ospitati all'esterno dell'hub di Azure Stack in Azure o in locale.</span><span class="sxs-lookup"><span data-stu-id="d07c2-138">Services like Azure Container Registry, Azure Monitor, and others, are hosted outside Azure Stack Hub in Azure or on-premises.</span></span> <span data-ttu-id="d07c2-139">Questo modello ibrido protegge la soluzione in caso di interruzione di una singola istanza dell'hub di Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="d07c2-139">This hybrid design protects the solution against outage of a single Azure Stack Hub instance.</span></span>

## <a name="components"></a><span data-ttu-id="d07c2-140">Componenti</span><span class="sxs-lookup"><span data-stu-id="d07c2-140">Components</span></span>

<span data-ttu-id="d07c2-141">L'architettura generale è costituita dai componenti seguenti:</span><span class="sxs-lookup"><span data-stu-id="d07c2-141">The overall architecture consists of the following components:</span></span>

<span data-ttu-id="d07c2-142">L'**hub di Azure Stack** è un'estensione di Azure che consente di eseguire i carichi di lavoro in un ambiente locale fornendo i servizi di Azure nel data center.</span><span class="sxs-lookup"><span data-stu-id="d07c2-142">**Azure Stack Hub** is an extension of Azure that can run workloads in an on-premises environment by providing Azure services in your datacenter.</span></span> <span data-ttu-id="d07c2-143">Per altre informazioni, vedere la [panoramica dell'hub di Azure Stack](/azure-stack/operator/azure-stack-overview).</span><span class="sxs-lookup"><span data-stu-id="d07c2-143">Go to [Azure Stack Hub overview](/azure-stack/operator/azure-stack-overview) to learn more.</span></span>

<span data-ttu-id="d07c2-144">Il **motore del servizio Azure Kubernetes** è il motore alla base dell'offerta di servizio Kubernetes gestito, il servizio Azure Kubernetes, già disponibile in Azure.</span><span class="sxs-lookup"><span data-stu-id="d07c2-144">**Azure Kubernetes Service Engine (AKS Engine)** is the engine behind the managed Kubernetes service offering, Azure Kubernetes Service (AKS), that is available in Azure today.</span></span> <span data-ttu-id="d07c2-145">Per l'hub di Azure Stack, il motore del servizio Azure Kubernetes consente di distribuire, dimensionare e aggiornare cluster Kubernetes completi e autogestiti usando le funzionalità IaaS dell'hub di Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="d07c2-145">For Azure Stack Hub, AKS Engine allows us to deploy, scale, and upgrade fully featured, self-managed Kubernetes clusters using Azure Stack Hub's IaaS capabilities.</span></span> <span data-ttu-id="d07c2-146">Per altre informazioni, vedere la [panoramica del motore del servizio Azure Kubernetes](https://github.com/Azure/aks-engine).</span><span class="sxs-lookup"><span data-stu-id="d07c2-146">Go to [AKS Engine Overview](https://github.com/Azure/aks-engine) to learn more.</span></span>

<span data-ttu-id="d07c2-147">Per altre informazioni sulle differenze tra il motore del servizio Azure Kubernetes in Azure e quello nell'hub di Azure Stack, vedere [Problemi noti e limitazioni](https://github.com/Azure/aks-engine/blob/master/docs/topics/azure-stack.md#known-issues-and-limitations).</span><span class="sxs-lookup"><span data-stu-id="d07c2-147">Go to [Known Issues and Limitations](https://github.com/Azure/aks-engine/blob/master/docs/topics/azure-stack.md#known-issues-and-limitations) to learn more about the differences between AKS Engine on Azure and AKS Engine on Azure Stack Hub.</span></span>

<span data-ttu-id="d07c2-148">Il servizio **Rete virtuale di Azure** viene usato per fornire l'infrastruttura di rete in ogni hub di Azure Stack per le macchine virtuali (VM) che ospitano l'infrastruttura del cluster Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="d07c2-148">**Azure Virtual Network (VNet)** is used to provide the network infrastructure on each Azure Stack Hub for the Virtual Machines (VMs) hosting the Kubernetes cluster infrastructure.</span></span>

<span data-ttu-id="d07c2-149">**Azure Load Balancer** viene usato per l'endpoint API di Kubernetes e per il controller in ingresso Nginx.</span><span class="sxs-lookup"><span data-stu-id="d07c2-149">**Azure Load Balancer** is used for the Kubernetes API Endpoint and the Nginx Ingress Controller.</span></span> <span data-ttu-id="d07c2-150">Questo servizio instrada il traffico esterno (ad esempio Internet) ai nodi e alle VM che offrono uno specifico servizio.</span><span class="sxs-lookup"><span data-stu-id="d07c2-150">The load balancer routes external (for example, Internet) traffic to nodes and VMs offering a specific service.</span></span>

<span data-ttu-id="d07c2-151">**Registro Azure Container** viene usato per archiviare le immagini Docker private e i grafici Helm, che vengono distribuiti nel cluster.</span><span class="sxs-lookup"><span data-stu-id="d07c2-151">**Azure Container Registry (ACR)** is used to store private Docker images and Helm charts, which are deployed to the cluster.</span></span> <span data-ttu-id="d07c2-152">Il motore del servizio Azure Kubernetes può eseguire l'autenticazione con Registro Azure Container usando un'identità di Azure AD.</span><span class="sxs-lookup"><span data-stu-id="d07c2-152">AKS Engine can authenticate with the Container Registry using an Azure AD identity.</span></span> <span data-ttu-id="d07c2-153">Kubernetes non richiede Registro Azure Container.</span><span class="sxs-lookup"><span data-stu-id="d07c2-153">Kubernetes doesn't require ACR.</span></span> <span data-ttu-id="d07c2-154">È possibile usare altri registri di contenitori, ad esempio l'hub Docker.</span><span class="sxs-lookup"><span data-stu-id="d07c2-154">You can use other container registries, such as Docker Hub.</span></span>

<span data-ttu-id="d07c2-155">**Azure Repos** è un set di strumenti di controllo della versione che è possibile usare per gestire il codice.</span><span class="sxs-lookup"><span data-stu-id="d07c2-155">**Azure Repos** is a set of version control tools that you can use to manage your code.</span></span> <span data-ttu-id="d07c2-156">È anche possibile usare GitHub o altri repository basati su git.</span><span class="sxs-lookup"><span data-stu-id="d07c2-156">You can also use GitHub or other git-based repositories.</span></span> <span data-ttu-id="d07c2-157">Per altre informazioni, vedere la [panoramica di Azure Repos](/azure/devops/repos/get-started/what-is-repos).</span><span class="sxs-lookup"><span data-stu-id="d07c2-157">Go to [Azure Repos Overview](/azure/devops/repos/get-started/what-is-repos) to learn more.</span></span>

<span data-ttu-id="d07c2-158">**Azure Pipelines** fa parte di Azure DevOps Services ed esegue compilazioni, test e distribuzioni automatizzati.</span><span class="sxs-lookup"><span data-stu-id="d07c2-158">**Azure Pipelines** is part of Azure DevOps Services and runs automated builds, tests, and deployments.</span></span> <span data-ttu-id="d07c2-159">È inoltre possibile usare soluzioni CI/CD di terze parti come Jenkins.</span><span class="sxs-lookup"><span data-stu-id="d07c2-159">You can also use third-party CI/CD solutions such as Jenkins.</span></span> <span data-ttu-id="d07c2-160">Per altre informazioni, vedere la [panoramica di Azure Pipelines](/azure/devops/pipelines/get-started/what-is-azure-pipelines).</span><span class="sxs-lookup"><span data-stu-id="d07c2-160">Go to [Azure Pipeline Overview](/azure/devops/pipelines/get-started/what-is-azure-pipelines) to learn more.</span></span>

<span data-ttu-id="d07c2-161">**Monitoraggio di Azure** raccoglie e archivia log e metriche, tra cui le metriche della piattaforma per i servizi di Azure nella soluzione e i dati di telemetria dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="d07c2-161">**Azure Monitor** collects and stores metrics and logs, including platform metrics for the Azure services in the solution and application telemetry.</span></span> <span data-ttu-id="d07c2-162">Usare questi dati per monitorare l'applicazione, configurare avvisi e dashboard ed eseguire l'analisi delle cause principali di errore.</span><span class="sxs-lookup"><span data-stu-id="d07c2-162">Use this data to monitor the application, set up alerts and dashboards, and perform root cause analysis of failures.</span></span> <span data-ttu-id="d07c2-163">Monitoraggio di Azure si integra con Kubernetes per raccogliere le metriche da controller, nodi e contenitori, nonché dai log di contenitori e nodi master.</span><span class="sxs-lookup"><span data-stu-id="d07c2-163">Azure Monitor integrates with Kubernetes to collect metrics from controllers, nodes, and containers, as well as container logs and master node logs.</span></span> <span data-ttu-id="d07c2-164">Per altre informazioni, vedere la [panoramica di Monitoraggio di Azure](/azure/azure-monitor/overview).</span><span class="sxs-lookup"><span data-stu-id="d07c2-164">Go to [Azure Monitor Overview](/azure/azure-monitor/overview) to learn more.</span></span>

<span data-ttu-id="d07c2-165">**Gestione traffico di Azure** è un servizio di bilanciamento del carico basato su DNS che consente di ottimizzare la distribuzione del traffico ai servizi in aree di Azure o in distribuzioni dell'hub di Azure Stack diverse.</span><span class="sxs-lookup"><span data-stu-id="d07c2-165">**Azure Traffic Manager** is a DNS-based traffic load balancer that enables you to distribute traffic optimally to services across different Azure regions or Azure Stack Hub deployments.</span></span> <span data-ttu-id="d07c2-166">Gestione traffico offre anche disponibilità elevata e tempi di risposta rapidi.</span><span class="sxs-lookup"><span data-stu-id="d07c2-166">Traffic Manager also provides high availability and responsiveness.</span></span> <span data-ttu-id="d07c2-167">Gli endpoint applicazione devono essere accessibili dall'esterno.</span><span class="sxs-lookup"><span data-stu-id="d07c2-167">The application endpoints must be accessible from the outside.</span></span> <span data-ttu-id="d07c2-168">Sono disponibili anche altre soluzioni locali.</span><span class="sxs-lookup"><span data-stu-id="d07c2-168">There are other on-premises solutions available as well.</span></span>

<span data-ttu-id="d07c2-169">Il **controller in ingresso di Kubernetes** espone route HTTP(S) ai servizi in un cluster Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="d07c2-169">**Kubernetes Ingress Controller** exposes HTTP(S) routes to services in a Kubernetes cluster.</span></span> <span data-ttu-id="d07c2-170">A questo scopo è possibile usare Nginx o qualsiasi altro controller in ingresso appropriato.</span><span class="sxs-lookup"><span data-stu-id="d07c2-170">Nginx or any suitable ingress controller can be used for this purpose.</span></span>

<span data-ttu-id="d07c2-171">**Helm** è un'utilità di gestione pacchetti per la distribuzione di Kubernetes, che offre la possibilità di raggruppare diversi oggetti di Kubernetes, come distribuzioni, servizi e segreti, in un singolo "grafico".</span><span class="sxs-lookup"><span data-stu-id="d07c2-171">**Helm** is a package manager for Kubernetes deployment, providing a way to bundle different Kubernetes objects like Deployments, Services, Secrets, into a single "chart".</span></span> <span data-ttu-id="d07c2-172">È possibile pubblicare, distribuire, gestire il controllo delle versioni e aggiornare un oggetto del grafico.</span><span class="sxs-lookup"><span data-stu-id="d07c2-172">You can publish, deploy, control version management, and update a chart  object.</span></span> <span data-ttu-id="d07c2-173">Come repository per archiviare i pacchetti di grafici Helm è possibile usare Registro Azure Container.</span><span class="sxs-lookup"><span data-stu-id="d07c2-173">Azure Container Registry can be used as a repository to store packaged Helm Charts.</span></span>

## <a name="design-considerations"></a><span data-ttu-id="d07c2-174">Considerazioni sulla progettazione</span><span class="sxs-lookup"><span data-stu-id="d07c2-174">Design considerations</span></span>

<span data-ttu-id="d07c2-175">Questo modello segue alcune considerazioni generali descritte in maggior dettaglio nelle sezioni successive dell'articolo:</span><span class="sxs-lookup"><span data-stu-id="d07c2-175">This pattern follows a few high-level considerations explained in more detail in the next sections of this article:</span></span>

- <span data-ttu-id="d07c2-176">L'applicazione usa soluzioni native di Kubernetes per evitare la dipendenza da un singolo fornitore.</span><span class="sxs-lookup"><span data-stu-id="d07c2-176">The application uses Kubernetes-native solutions, to avoid vendor lock-in.</span></span>
- <span data-ttu-id="d07c2-177">L'applicazione usa un'architettura di microservizi.</span><span class="sxs-lookup"><span data-stu-id="d07c2-177">The application uses a microservices architecture.</span></span>
- <span data-ttu-id="d07c2-178">L'hub di Azure Stack non richiede connettività Internet in ingresso ma consente quella in uscita.</span><span class="sxs-lookup"><span data-stu-id="d07c2-178">Azure Stack Hub doesn't need inbound but allows outbound Internet connectivity.</span></span>

<span data-ttu-id="d07c2-179">Queste procedure consigliate si applicano anche a carichi di lavoro e scenari reali.</span><span class="sxs-lookup"><span data-stu-id="d07c2-179">These recommended practices will apply to real-world workloads and scenarios as well.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="d07c2-180">Considerazioni sulla scalabilità</span><span class="sxs-lookup"><span data-stu-id="d07c2-180">Scalability considerations</span></span>

<span data-ttu-id="d07c2-181">La scalabilità è importante per offrire agli utenti l'accesso coerente, affidabile e funzionante alle applicazioni.</span><span class="sxs-lookup"><span data-stu-id="d07c2-181">Scalability is important to provide users consistent, reliable, and well-performing access to the application.</span></span>

<span data-ttu-id="d07c2-182">Lo scenario di esempio illustra la scalabilità su più livelli dello stack dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="d07c2-182">The sample scenario covers scalability on multiple layers of the application stack.</span></span> <span data-ttu-id="d07c2-183">Ecco una panoramica generale dei diversi livelli:</span><span class="sxs-lookup"><span data-stu-id="d07c2-183">Here's a high-level overview of the different layers:</span></span>

| <span data-ttu-id="d07c2-184">Livello dell'architettura</span><span class="sxs-lookup"><span data-stu-id="d07c2-184">Architecture level</span></span> | <span data-ttu-id="d07c2-185">Impatto</span><span class="sxs-lookup"><span data-stu-id="d07c2-185">Affects</span></span> | <span data-ttu-id="d07c2-186">Come si procede?</span><span class="sxs-lookup"><span data-stu-id="d07c2-186">How?</span></span> |
| --- | --- | ---
| <span data-ttu-id="d07c2-187">Applicazione</span><span class="sxs-lookup"><span data-stu-id="d07c2-187">Application</span></span> | <span data-ttu-id="d07c2-188">Applicazione</span><span class="sxs-lookup"><span data-stu-id="d07c2-188">Application</span></span> | <span data-ttu-id="d07c2-189">Scalabilità orizzontale in base al numero di pod/repliche/istanze di contenitore\*</span><span class="sxs-lookup"><span data-stu-id="d07c2-189">Horizontal scaling based on the number of Pods/Replicas/Container Instances\*</span></span> |
| <span data-ttu-id="d07c2-190">Cluster</span><span class="sxs-lookup"><span data-stu-id="d07c2-190">Cluster</span></span> | <span data-ttu-id="d07c2-191">Cluster Kubernetes</span><span class="sxs-lookup"><span data-stu-id="d07c2-191">Kubernetes cluster</span></span> | <span data-ttu-id="d07c2-192">Numero di nodi (compreso tra 1 e 50), dimensioni degli SKU di VM e pool di nodi (il motore del servizio Azure Kubernetes nell'hub di Azure Stack supporta attualmente solo un pool a nodo singolo); uso del comando scale (manuale) del motore del servizio Azure Kubernetes</span><span class="sxs-lookup"><span data-stu-id="d07c2-192">Number of Nodes (between 1 and 50), VM-SKU-sizes, and Node Pools (AKS Engine on Azure Stack Hub currently supports only a single node pool); using AKS Engine's scale command (manual)</span></span> |
| <span data-ttu-id="d07c2-193">Infrastruttura</span><span class="sxs-lookup"><span data-stu-id="d07c2-193">Infrastructure</span></span> | <span data-ttu-id="d07c2-194">Hub di Azure Stack</span><span class="sxs-lookup"><span data-stu-id="d07c2-194">Azure Stack Hub</span></span> | <span data-ttu-id="d07c2-195">Numero di nodi, capacità e unità di scala all'interno di una distribuzione dell'hub di Azure Stack</span><span class="sxs-lookup"><span data-stu-id="d07c2-195">Number of nodes, capacity, and scale units within an Azure Stack Hub deployment</span></span> |

<span data-ttu-id="d07c2-196">\* Uso dello strumento Horizontal Pod Autoscaler (HPA) di Kubernetes; scalabilità automatica basata su metriche o scalabilità verticale tramite dimensionamento delle istanze di contenitore (CPU/memoria).</span><span class="sxs-lookup"><span data-stu-id="d07c2-196">\* Using Kubernetes' Horizontal Pod Autoscaler (HPA); automated metric-based scaling or vertical scaling by sizing the container instances (cpu/memory).</span></span>

<span data-ttu-id="d07c2-197">**Hub di Azure Stack (livello dell'infrastruttura)**</span><span class="sxs-lookup"><span data-stu-id="d07c2-197">**Azure Stack Hub (infrastructure level)**</span></span>

<span data-ttu-id="d07c2-198">L'infrastruttura dell'hub di Azure Stack è la base di questa implementazione, perché l'hub di Azure Stack viene eseguito su hardware fisico in un data center.</span><span class="sxs-lookup"><span data-stu-id="d07c2-198">The Azure Stack Hub infrastructure is the foundation of this implementation, because Azure Stack Hub runs on physical hardware in a datacenter.</span></span> <span data-ttu-id="d07c2-199">Quando si seleziona l'hardware dell'hub, è necessario scegliere CPU, densità di memoria, configurazione dell'archiviazione e numero di server.</span><span class="sxs-lookup"><span data-stu-id="d07c2-199">When selecting your Hub hardware, you need to make choices for CPU, memory density, storage configuration, and number of servers.</span></span> <span data-ttu-id="d07c2-200">Per altre informazioni sulla scalabilità dell'hub di Azure Stack, vedere le risorse seguenti:</span><span class="sxs-lookup"><span data-stu-id="d07c2-200">To learn more about Azure Stack Hub's scalability, check out the following resources:</span></span>

- [<span data-ttu-id="d07c2-201">Panoramica della pianificazione della capacità per l'hub di Azure Stack</span><span class="sxs-lookup"><span data-stu-id="d07c2-201">Capacity planning for Azure Stack Hub overview</span></span>](/azure-stack/operator/azure-stack-capacity-planning-overview)
- [<span data-ttu-id="d07c2-202">Aggiungere altri nodi di unità di scala aggiuntivi nell'hub di Azure Stack</span><span class="sxs-lookup"><span data-stu-id="d07c2-202">Add additional scale unit nodes in Azure Stack Hub</span></span>](/azure-stack/operator/azure-stack-add-scale-node)

<span data-ttu-id="d07c2-203">**Cluster Kubernetes (livello del cluster)**</span><span class="sxs-lookup"><span data-stu-id="d07c2-203">**Kubernetes cluster (cluster level)**</span></span>

<span data-ttu-id="d07c2-204">Il cluster Kubernetes è costituito da ed è basato su componenti dell'infrastruttura IaaS di Azure Stack, tra cui risorse di calcolo, archiviazione e rete.</span><span class="sxs-lookup"><span data-stu-id="d07c2-204">The Kubernetes cluster itself consists of, and is built on top of Azure (Stack) IaaS components including compute, storage, and network resources.</span></span> <span data-ttu-id="d07c2-205">Le soluzioni Kubernetes includono nodi master e di lavoro, che vengono distribuiti come VM in Azure (e nell'hub di Azure Stack).</span><span class="sxs-lookup"><span data-stu-id="d07c2-205">Kubernetes solutions involve master and worker nodes, which are deployed as VMs in Azure (and Azure Stack Hub).</span></span>

- <span data-ttu-id="d07c2-206">I [nodi del piano di controllo](/azure/aks/concepts-clusters-workloads#control-plane) (master) forniscono i servizi Kubernetes di base e l'orchestrazione dei carichi di lavoro dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="d07c2-206">[Control plane nodes](/azure/aks/concepts-clusters-workloads#control-plane) (master) provide the core Kubernetes services and orchestration of application workloads.</span></span>
- <span data-ttu-id="d07c2-207">I [nodi di lavoro](/azure/aks/concepts-clusters-workloads#nodes-and-node-pools) eseguono i carichi di lavoro dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="d07c2-207">[Worker nodes](/azure/aks/concepts-clusters-workloads#nodes-and-node-pools) (worker) run your application workloads.</span></span>

<span data-ttu-id="d07c2-208">Per la selezione delle dimensioni delle VM per la distribuzione iniziale, è necessario considerare gli aspetti seguenti:</span><span class="sxs-lookup"><span data-stu-id="d07c2-208">When selecting VM sizes for the initial deployment, there are several considerations:</span></span>  

- <span data-ttu-id="d07c2-209">**Costo**: quando si pianificano i nodi di lavoro, tenere presente il costo complessivo in cui si incorrerà per ogni macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="d07c2-209">**Cost** - When planning your worker nodes, keep in mind the overall cost per VM you'll incur.</span></span> <span data-ttu-id="d07c2-210">Se ad esempio i carichi di lavoro dell'applicazione richiedono risorse limitate, è consigliabile pianificare la distribuzione di VM di dimensioni inferiori.</span><span class="sxs-lookup"><span data-stu-id="d07c2-210">For example, if your application workloads require limited resources, you should plan to deploy smaller sized VMs.</span></span> <span data-ttu-id="d07c2-211">L'hub di Azure Stack, come Azure, viene in genere fatturato a consumo, quindi per ottimizzare i costi a consumo, è fondamentale dimensionare in modo appropriato le VM per i ruoli di Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="d07c2-211">Azure Stack Hub, like Azure, is normally billed on a consumption basis, so appropriately sizing the VMs for Kubernetes roles is crucial to optimizing consumption costs.</span></span> 

- <span data-ttu-id="d07c2-212">**Scalabilità**: la scalabilità del cluster si ottiene tramite l'aumento e la riduzione del numero di nodi master e di lavoro oppure con l'aggiunta di altri pool di nodi (opzioni attualmente non disponibile per l'hub di Azure Stack).</span><span class="sxs-lookup"><span data-stu-id="d07c2-212">**Scalability** - Scalability of the cluster is achieved by scaling in and out the number of master and worker nodes, or by adding additional node pools (not available on Azure Stack Hub today).</span></span> <span data-ttu-id="d07c2-213">Il dimensionamento del cluster può essere eseguito in base ai dati sulle prestazioni, raccolti tramite Informazioni dettagliate contenitore (Monitoraggio di Azure + Log Analytics).</span><span class="sxs-lookup"><span data-stu-id="d07c2-213">Scaling the cluster can be done based on performance data, collected using Container Insights (Azure Monitor + Log Analytics).</span></span> 

    <span data-ttu-id="d07c2-214">Se l'applicazione necessita di più o meno risorse, è possibile aumentare o ridurre i nodi correnti orizzontalmente (tra 1 e 50 nodi).</span><span class="sxs-lookup"><span data-stu-id="d07c2-214">If your application needs more (or fewer) resources, you can scale out (or in) your current nodes horizontally (between 1 and 50 nodes).</span></span> <span data-ttu-id="d07c2-215">Se sono necessari più di 50 nodi, è possibile creare un cluster aggiuntivo in una sottoscrizione separata.</span><span class="sxs-lookup"><span data-stu-id="d07c2-215">If you need more than 50 nodes, you can create an additional cluster in a separate subscription.</span></span> <span data-ttu-id="d07c2-216">Non è possibile scalare verticalmente le VM effettive passando ad altre dimensioni di VM senza ridistribuire il cluster.</span><span class="sxs-lookup"><span data-stu-id="d07c2-216">You can't scale up the actual VMs vertically to another VM size without redeploying the cluster.</span></span>

    <span data-ttu-id="d07c2-217">La scalabilità viene applicata manualmente tramite la VM helper del motore del servizio Azure Kubernetes usata per la distribuzione iniziale del cluster Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="d07c2-217">Scaling is done manually using the AKS Engine helper VM that was used to deploy the Kubernetes cluster initially.</span></span> <span data-ttu-id="d07c2-218">Per altre informazioni, vedere [Scalabilità dei cluster Kubernetes](https://github.com/Azure/aks-engine/blob/master/docs/topics/scale.md)</span><span class="sxs-lookup"><span data-stu-id="d07c2-218">For more information, see [Scaling Kubernetes clusters](https://github.com/Azure/aks-engine/blob/master/docs/topics/scale.md)</span></span>

- <span data-ttu-id="d07c2-219">**Quote**: considerare le [quote](/azure-stack/operator/azure-stack-quota-types) configurate durante la pianificazione di una distribuzione del servizio Azure Kubernetes nell'hub di Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="d07c2-219">**Quotas** - Consider the [quotas](/azure-stack/operator/azure-stack-quota-types) you've configured when planning out an AKS deployment on your Azure Stack Hub.</span></span> <span data-ttu-id="d07c2-220">Assicurarsi che per ogni [sottoscrizione](/azure-stack/operator/service-plan-offer-subscription-overview) siano stati configurati piani e quote appropriati.</span><span class="sxs-lookup"><span data-stu-id="d07c2-220">Make sure each [subscription](/azure-stack/operator/service-plan-offer-subscription-overview) has the proper plans and the quotas configured.</span></span> <span data-ttu-id="d07c2-221">La sottoscrizione dovrà supportare l'aumento della quantità di risorse di calcolo e di archiviazione e degli altri servizi necessari per i cluster.</span><span class="sxs-lookup"><span data-stu-id="d07c2-221">The subscription will need to accommodate the amount of compute, storage, and other services needed for your clusters as they scale out.</span></span>

- <span data-ttu-id="d07c2-222">**Carichi di lavoro dell'applicazione**: vedere la sezione sui [concetti di cluster e carichi di lavoro](/azure/aks/concepts-clusters-workloads#nodes-and-node-pools) nel documento sui concetti di base di Kubernetes per il servizio Azure Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="d07c2-222">**Application workloads** - Refer to the [Clusters and workloads concepts](/azure/aks/concepts-clusters-workloads#nodes-and-node-pools) in the Kubernetes core concepts for Azure Kubernetes Service document.</span></span> <span data-ttu-id="d07c2-223">Questo articolo consentirà di definire le dimensioni appropriate per le VM in base alle esigenze di calcolo e memoria dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="d07c2-223">This article will help you scope the proper VM size based on the compute and memory needs of your application.</span></span>  

<span data-ttu-id="d07c2-224">**Applicazione (livello dell'applicazione)**</span><span class="sxs-lookup"><span data-stu-id="d07c2-224">**Application (application level)**</span></span>

<span data-ttu-id="d07c2-225">Nel livello dell'applicazione viene usato lo strumento [Horizontal Pod Autoscaler (HPA)](https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/) di Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="d07c2-225">On the application layer, we use Kubernetes [Horizontal Pod Autoscaler (HPA)](https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/).</span></span> <span data-ttu-id="d07c2-226">HPA consente di aumentare o ridurre il numero di repliche (istanze di pod/contenitori) nella distribuzione in base a metriche differenti, ad esempio l'utilizzo della CPU.</span><span class="sxs-lookup"><span data-stu-id="d07c2-226">HPA can increase or decrease the number of Replicas (Pod/Container Instances) in our deployment based on different metrics (like CPU utilization).</span></span>

<span data-ttu-id="d07c2-227">Un'altra opzione consiste nel dimensionare le istanze di contenitori verticalmente.</span><span class="sxs-lookup"><span data-stu-id="d07c2-227">Another option is to scale container instances vertically.</span></span> <span data-ttu-id="d07c2-228">A questo scopo, è necessario cambiare le quantità di CPU e memoria richieste e disponibili per una specifica distribuzione.</span><span class="sxs-lookup"><span data-stu-id="d07c2-228">This can be accomplished by changing the amount of CPU and Memory requested and available for a specific deployment.</span></span> <span data-ttu-id="d07c2-229">Per altre informazioni, vedere [Gestione delle risorse per i contenitori](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/) in kubernetes.io.</span><span class="sxs-lookup"><span data-stu-id="d07c2-229">See [Managing Resources for Containers](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/) on kubernetes.io to learn more.</span></span>

## <a name="networking-and-connectivity-considerations"></a><span data-ttu-id="d07c2-230">Considerazioni su rete e connettività</span><span class="sxs-lookup"><span data-stu-id="d07c2-230">Networking and connectivity considerations</span></span>

<span data-ttu-id="d07c2-231">Anche la rete e la connettività influiscono sui tre livelli citati in precedenza per Kubernetes nell'hub di Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="d07c2-231">Networking and connectivity also affect the three layers mentioned previously for Kubernetes on Azure Stack Hub.</span></span> <span data-ttu-id="d07c2-232">La tabella seguente illustra i livelli e i servizi che contengono:</span><span class="sxs-lookup"><span data-stu-id="d07c2-232">The following table shows the layers and which services they contain:</span></span>

| <span data-ttu-id="d07c2-233">Livello</span><span class="sxs-lookup"><span data-stu-id="d07c2-233">Layer</span></span> | <span data-ttu-id="d07c2-234">Impatto</span><span class="sxs-lookup"><span data-stu-id="d07c2-234">Affects</span></span> | <span data-ttu-id="d07c2-235">Cosa?</span><span class="sxs-lookup"><span data-stu-id="d07c2-235">What?</span></span> |
| --- | --- | ---
| <span data-ttu-id="d07c2-236">Applicazione</span><span class="sxs-lookup"><span data-stu-id="d07c2-236">Application</span></span> | <span data-ttu-id="d07c2-237">Applicazione</span><span class="sxs-lookup"><span data-stu-id="d07c2-237">Application</span></span> | <span data-ttu-id="d07c2-238">Come si accede all'applicazione?</span><span class="sxs-lookup"><span data-stu-id="d07c2-238">How is the application accessible?</span></span> <span data-ttu-id="d07c2-239">Verrà esposta su Internet?</span><span class="sxs-lookup"><span data-stu-id="d07c2-239">Will it be exposed to the Internet?</span></span> |
| <span data-ttu-id="d07c2-240">Cluster</span><span class="sxs-lookup"><span data-stu-id="d07c2-240">Cluster</span></span> | <span data-ttu-id="d07c2-241">Cluster Kubernetes</span><span class="sxs-lookup"><span data-stu-id="d07c2-241">Kubernetes cluster</span></span> | <span data-ttu-id="d07c2-242">API Kubernetes, VM del motore del servizio Azure Kubernetes, pull di immagini di contenitori (in uscita), invio di dati di monitoraggio e di telemetria (in uscita)</span><span class="sxs-lookup"><span data-stu-id="d07c2-242">Kubernetes API, AKS Engine VM, Pulling container images (egress), Sending monitoring data and telemetry (egress)</span></span> |
| <span data-ttu-id="d07c2-243">Infrastruttura</span><span class="sxs-lookup"><span data-stu-id="d07c2-243">Infrastructure</span></span> | <span data-ttu-id="d07c2-244">Hub di Azure Stack</span><span class="sxs-lookup"><span data-stu-id="d07c2-244">Azure Stack Hub</span></span> | <span data-ttu-id="d07c2-245">Accessibilità degli endpoint di gestione dell'hub di Azure Stack, come il portale e gli endpoint di Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="d07c2-245">Accessibility of the Azure Stack Hub management endpoints like the portal and Azure Resource Manager endpoints.</span></span> |

<span data-ttu-id="d07c2-246">**Applicazione**</span><span class="sxs-lookup"><span data-stu-id="d07c2-246">**Application**</span></span>

<span data-ttu-id="d07c2-247">Per il livello dell'applicazione, l'aspetto più importante da considerare è se l'applicazione è esposta e accessibile da Internet.</span><span class="sxs-lookup"><span data-stu-id="d07c2-247">For the application layer, the most important consideration is whether the application is exposed and accessible from the Internet.</span></span> <span data-ttu-id="d07c2-248">Dal punto di vista di Kubernetes, l'accessibilità tramite Internet significa esporre una distribuzione o un pod usando un servizio Kubernetes o un controller in ingresso.</span><span class="sxs-lookup"><span data-stu-id="d07c2-248">From a Kubernetes perspective, Internet accessibility means exposing a deployment or pod using a Kubernetes Service or an Ingress Controller.</span></span>

> [!NOTE]
> <span data-ttu-id="d07c2-249">È consigliabile usare i controller in ingresso per esporre i servizi Kubernetes, perché il numero di indirizzi IP pubblici front-end nell'hub di Azure Stack è limitato a 5.</span><span class="sxs-lookup"><span data-stu-id="d07c2-249">We recommend the use of Ingress controllers to expose Kubernetes Services as the number of Frontend public IPs on Azure Stack Hub is limited to 5.</span></span> <span data-ttu-id="d07c2-250">Questo modello limita a 5 anche il numero di servizi Kubernetes (con il tipo LoadBalancer), che risulterà eccessivamente piccolo per molte distribuzioni.</span><span class="sxs-lookup"><span data-stu-id="d07c2-250">This design also limits the number of Kubernetes Services (with the type LoadBalancer) to 5, which will be too small for many deployments.</span></span> <span data-ttu-id="d07c2-251">Per altre informazioni, vedere la [documentazione del motore del servizio Azure Kubernetes](https://github.com/Azure/aks-engine/blob/master/docs/topics/azure-stack.md#limited-number-of-frontend-public-ips).</span><span class="sxs-lookup"><span data-stu-id="d07c2-251">Go to the [AKS Engine documentation](https://github.com/Azure/aks-engine/blob/master/docs/topics/azure-stack.md#limited-number-of-frontend-public-ips) to learn more.</span></span>

<span data-ttu-id="d07c2-252">L'esposizione di un'applicazione usando un indirizzo IP pubblico tramite un servizio di bilanciamento del carico o un controller in ingresso non implica necessariamente che l'applicazione sia accessibile tramite Internet.</span><span class="sxs-lookup"><span data-stu-id="d07c2-252">Exposing an application using a public IP via a Load Balancer or an Ingress Controller doesn't nessecarily mean that the application is now accessible via the Internet.</span></span> <span data-ttu-id="d07c2-253">È possibile che l'hub di Azure Stack abbia un indirizzo IP pubblico visibile solo nella Intranet locale. Non tutti gli indirizzi IP pubblici sono infatti accessibili da Internet.</span><span class="sxs-lookup"><span data-stu-id="d07c2-253">It's possible for Azure Stack Hub to have a public IP address that is only visible on the local intranet - not all public IPs are truly Internet-facing.</span></span>

<span data-ttu-id="d07c2-254">Il blocco precedente considera il traffico in ingresso nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="d07c2-254">The previous block considers ingress traffic to the application.</span></span> <span data-ttu-id="d07c2-255">Un altro aspetto da considerare per il successo di una distribuzione di Kubernetes è il traffico in uscita.</span><span class="sxs-lookup"><span data-stu-id="d07c2-255">Another topic that must be considered for a successful Kubernetes deployment is outbound/egress traffic.</span></span> <span data-ttu-id="d07c2-256">Ecco alcuni casi d'uso che richiedono il traffico in uscita:</span><span class="sxs-lookup"><span data-stu-id="d07c2-256">Here are a few use cases that require egress traffic:</span></span>

- <span data-ttu-id="d07c2-257">Pull di immagini di contenitori archiviate in DockerHub o in Registro Azure Container</span><span class="sxs-lookup"><span data-stu-id="d07c2-257">Pulling Container Images stored on DockerHub or Azure Container Registry</span></span>
- <span data-ttu-id="d07c2-258">Recupero di grafici Helm</span><span class="sxs-lookup"><span data-stu-id="d07c2-258">Retrieving Helm Charts</span></span>
- <span data-ttu-id="d07c2-259">Invio di dati di Application Insights (o altri dati di monitoraggio)</span><span class="sxs-lookup"><span data-stu-id="d07c2-259">Emitting Application Insights data (or other monitoring data)</span></span>

<span data-ttu-id="d07c2-260">Alcuni ambienti aziendali potrebbero richiedere l'uso di server proxy _trasparenti_ o _non trasparenti_.</span><span class="sxs-lookup"><span data-stu-id="d07c2-260">Some enterprise environments might require the use of _transparent_ or _non-transparent_ proxy servers.</span></span> <span data-ttu-id="d07c2-261">Per questi server è necessaria una configurazione specifica di vari componenti del cluster.</span><span class="sxs-lookup"><span data-stu-id="d07c2-261">These servers require specific configuration on various components of our cluster.</span></span> <span data-ttu-id="d07c2-262">La documentazione del motore del servizio Azure Kubernetes contiene varie informazioni su come gestire i proxy di rete.</span><span class="sxs-lookup"><span data-stu-id="d07c2-262">The AKS Engine documentation contains various details on how to accommodate network proxies.</span></span> <span data-ttu-id="d07c2-263">Per informazioni più dettagliate, vedere [Motore del servizio Azure Kubernetes e server proxy](https://github.com/Azure/aks-engine/blob/master/docs/topics/proxy-servers.md)</span><span class="sxs-lookup"><span data-stu-id="d07c2-263">For more details, see [AKS Engine and proxy servers](https://github.com/Azure/aks-engine/blob/master/docs/topics/proxy-servers.md)</span></span>

<span data-ttu-id="d07c2-264">Infine, il traffico tra cluster deve fluire tra le istanze dell'hub di Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="d07c2-264">Lastly, cross-cluster traffic must flow between Azure Stack Hub instances.</span></span> <span data-ttu-id="d07c2-265">La distribuzione di esempio è costituita da singoli cluster Kubernetes in esecuzione in singole istanze dell'hub di Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="d07c2-265">The sample deployment consists of individual Kubernetes clusters running on individual Azure Stack Hub instances.</span></span> <span data-ttu-id="d07c2-266">Il traffico tra questi componenti, ad esempio il traffico di replica tra due database, è considerato "traffico esterno".</span><span class="sxs-lookup"><span data-stu-id="d07c2-266">Traffic between them, such as the replication traffic between two databases, is "external traffic".</span></span> <span data-ttu-id="d07c2-267">Il traffico esterno deve essere instradato tramite una VPN da sito a sito o tramite indirizzi IP pubblici dell'hub di Azure Stack per connettere Kubernetes in due istanze dell'hub di Azure Stack:</span><span class="sxs-lookup"><span data-stu-id="d07c2-267">External traffic must be routed through either a Site-to-Site VPN or Azure Stack Hub Public IP addresses to connect Kubernetes on two Azure Stack Hub instances:</span></span>

![Traffico inter e intra cluster](media/pattern-highly-available-kubernetes/aks-inter-and-intra-cluster-traffic.png)

<span data-ttu-id="d07c2-269">**Cluster**</span><span class="sxs-lookup"><span data-stu-id="d07c2-269">**Cluster**</span></span>  

<span data-ttu-id="d07c2-270">Il cluster Kubernetes non deve necessariamente essere accessibile tramite Internet.</span><span class="sxs-lookup"><span data-stu-id="d07c2-270">The Kubernetes cluster doesn't necessarily need to be accessible via the Internet.</span></span> <span data-ttu-id="d07c2-271">La parte pertinente è l'API Kubernetes usata per gestire un cluster, ad esempio tramite `kubectl`.</span><span class="sxs-lookup"><span data-stu-id="d07c2-271">The relevant part is the Kubernetes API used to operate a cluster, for example, using `kubectl`.</span></span> <span data-ttu-id="d07c2-272">L'endpoint API di Kubernetes deve essere accessibile a tutti gli utenti che gestiscono il cluster o che vi distribuiscono applicazioni e servizi.</span><span class="sxs-lookup"><span data-stu-id="d07c2-272">The Kubernetes API endpoint must be accessible to everyone who operates the cluster or deploys applications and services on top of it.</span></span> <span data-ttu-id="d07c2-273">Questo aspetto viene trattato in maggior dettaglio dal punto di vista di DevOps nella sezione [Considerazioni sulla distribuzione (CI/CD)](#deployment-cicd-considerations) di seguito.</span><span class="sxs-lookup"><span data-stu-id="d07c2-273">This topic is covered in more detail from a DevOps-perspective in the [Deployment (CI/CD) considerations](#deployment-cicd-considerations) section below.</span></span>

<span data-ttu-id="d07c2-274">Nel livello del cluster esistono anche alcune considerazioni sul traffico in uscita:</span><span class="sxs-lookup"><span data-stu-id="d07c2-274">On the cluster level, there are also a few considerations around egress-traffic:</span></span>

- <span data-ttu-id="d07c2-275">Aggiornamenti dei nodi (per Ubuntu)</span><span class="sxs-lookup"><span data-stu-id="d07c2-275">Node updates (for Ubuntu)</span></span>
- <span data-ttu-id="d07c2-276">Dati di monitoraggio (inviati ad Azure LogAnalytics)</span><span class="sxs-lookup"><span data-stu-id="d07c2-276">Monitoring data (sent to Azure LogAnalytics)</span></span>
- <span data-ttu-id="d07c2-277">Altri agenti che richiedono il traffico in uscita (specifico per l'ambiente di ogni distribuzione)</span><span class="sxs-lookup"><span data-stu-id="d07c2-277">Other agents requiring outbound traffic (specific to each deployer's environment)</span></span>

<span data-ttu-id="d07c2-278">Prima di distribuire il cluster Kubernetes usando il motore del servizio Azure Kubernetes, pianificare l'architettura finale della rete.</span><span class="sxs-lookup"><span data-stu-id="d07c2-278">Before you deploy your Kubernetes cluster using AKS Engine, plan for the final networking design.</span></span> <span data-ttu-id="d07c2-279">Invece di creare una rete virtuale dedicata, può risultare più efficiente distribuire un cluster in una rete esistente.</span><span class="sxs-lookup"><span data-stu-id="d07c2-279">Instead of creating a dedicated Virtual Network, it may be more efficient to deploy a cluster into an existing network.</span></span> <span data-ttu-id="d07c2-280">Ad esempio, è possibile usare una connessione VPN da sito a sito esistente già configurata nell'ambiente dell'hub di Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="d07c2-280">For example, you might leverage an existing Site-to-Site VPN connection already configured in your Azure Stack Hub environment.</span></span>

<span data-ttu-id="d07c2-281">**Infrastruttura**</span><span class="sxs-lookup"><span data-stu-id="d07c2-281">**Infrastructure**</span></span>  

<span data-ttu-id="d07c2-282">L'infrastruttura si riferisce all'accesso agli endpoint di gestione dell'hub di Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="d07c2-282">Infrastructure refers to accessing the Azure Stack Hub management endpoints.</span></span> <span data-ttu-id="d07c2-283">Gli endpoint includono i portali di tenant e amministrazione e gli endpoint di tenant e amministrazione di Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="d07c2-283">Endpoints include the tenant and admin portals, and the Azure Resource Manager admin and tenant endpoints.</span></span> <span data-ttu-id="d07c2-284">Questi endpoint sono necessari per il funzionamento dell'hub di Azure Stack e dei relativi servizi di base.</span><span class="sxs-lookup"><span data-stu-id="d07c2-284">These endpoints are required to operate Azure Stack Hub and its core services.</span></span>

## <a name="data-and-storage-considerations"></a><span data-ttu-id="d07c2-285">Considerazioni su dati e archiviazione</span><span class="sxs-lookup"><span data-stu-id="d07c2-285">Data and storage considerations</span></span>

<span data-ttu-id="d07c2-286">Verranno distribuite due istanze dell'applicazione in due singoli cluster Kubernetes tra due istanze dell'hub di Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="d07c2-286">Two instances of our application will be deployed, on two individual Kubernetes clusters, across two Azure Stack Hub instances.</span></span> <span data-ttu-id="d07c2-287">Per questo modello è necessario valutare come replicare e sincronizzare i dati tra i componenti.</span><span class="sxs-lookup"><span data-stu-id="d07c2-287">This design will require us to consider how to replicate and synchronize data between them.</span></span>

<span data-ttu-id="d07c2-288">Azure include la funzionalità predefinita per la replica dell'archiviazione tra più aree e zone all'interno del cloud.</span><span class="sxs-lookup"><span data-stu-id="d07c2-288">With Azure, we have the built-in capability to replicate storage across multiple regions and zones within the cloud.</span></span> <span data-ttu-id="d07c2-289">Attualmente con l'hub di Azure Stack non sono disponibili modalità native per replicare l'archiviazione tra due diverse istanze dell'hub di Azure Stack, perché formano due cloud indipendenti che non è possibile gestire come set.</span><span class="sxs-lookup"><span data-stu-id="d07c2-289">Currently with Azure Stack Hub there are no native ways to replicate storage across two different Azure Stack Hub instances - they form two independent clouds with no overarching way to manage them as a set.</span></span> <span data-ttu-id="d07c2-290">La pianificazione della resilienza delle applicazioni in esecuzione nell'hub di Azure Stack impone di tenere conto di questa indipendenza nella progettazione e nelle distribuzioni dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="d07c2-290">Planning for resiliency of applications running across Azure Stack Hub forces you to consider this independence in your application design and deployments.</span></span>

<span data-ttu-id="d07c2-291">Nella maggior parte dei casi, la replica dell'archiviazione non è necessaria per un'applicazione resiliente e a disponibilità elevata distribuita nel servizio Azure Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="d07c2-291">In most cases, storage replication won't be necessary for a resilient and highly available application deployed on AKS.</span></span> <span data-ttu-id="d07c2-292">Tuttavia, è necessario considerare l'archiviazione indipendente per ogni istanza dell'hub di Azure Stack nella progettazione dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="d07c2-292">But you should consider independent storage per Azure Stack Hub instance in your application design.</span></span> <span data-ttu-id="d07c2-293">Se questo aspetto rappresenta un problema o un ostacolo per la distribuzione della soluzione nell'hub di Azure Stack, sono disponibili soluzioni dei partner Microsoft che forniscono connessioni all'archiviazione.</span><span class="sxs-lookup"><span data-stu-id="d07c2-293">If this design is a concern or road block to deploying the solution on Azure Stack Hub, there are possible solutions from Microsoft Partners that provide storage attachments.</span></span> <span data-ttu-id="d07c2-294">Le connessioni all'archiviazione offrono una soluzione di replica dell'archiviazione tra più hub di Azure Stack e Azure.</span><span class="sxs-lookup"><span data-stu-id="d07c2-294">Storage attachments provide a storage replication solution across multiple Azure Stack Hubs and Azure.</span></span> <span data-ttu-id="d07c2-295">Per altre informazioni, vedere le [soluzioni dei partner](#partner-solutions).</span><span class="sxs-lookup"><span data-stu-id="d07c2-295">For more information, see the [Partner solutions](#partner-solutions).</span></span>

<span data-ttu-id="d07c2-296">In questa architettura vengono considerati i livelli seguenti:</span><span class="sxs-lookup"><span data-stu-id="d07c2-296">In our architecture, these layers were considered:</span></span>

<span data-ttu-id="d07c2-297">**Configuration**</span><span class="sxs-lookup"><span data-stu-id="d07c2-297">**Configuration**</span></span>

<span data-ttu-id="d07c2-298">La configurazione riguarda l'hub di Azure Stack, il motore del servizio Azure Kubernetes e il cluster Kubernetes stesso.</span><span class="sxs-lookup"><span data-stu-id="d07c2-298">Configuration includes the configuration of Azure Stack Hub, AKS Engine, and the Kubernetes cluster itself.</span></span> <span data-ttu-id="d07c2-299">La configurazione deve essere automatizzata il più possibile e archiviata come Infrastructure-as-Code in un sistema di controllo della versione basato su Git come Azure DevOps o GitHub.</span><span class="sxs-lookup"><span data-stu-id="d07c2-299">The configuration should be automated as much as possible, and stored as Infrastructure-as-Code in a Git-based version control system like Azure DevOps or GitHub.</span></span> <span data-ttu-id="d07c2-300">Queste impostazioni non possono essere facilmente sincronizzate tra più distribuzioni.</span><span class="sxs-lookup"><span data-stu-id="d07c2-300">These settings cannot easily be synchronized across multiple deployments.</span></span> <span data-ttu-id="d07c2-301">È quindi consigliabile archiviare e applicare la configurazione dall'esterno e usare la pipeline DevOps.</span><span class="sxs-lookup"><span data-stu-id="d07c2-301">Therefore we recommend storing and applying configuration from the outside, and using DevOps pipeline.</span></span>

<span data-ttu-id="d07c2-302">**Applicazione**</span><span class="sxs-lookup"><span data-stu-id="d07c2-302">**Application**</span></span>

<span data-ttu-id="d07c2-303">L'applicazione dovrà essere archiviata in un repository basato su Git.</span><span class="sxs-lookup"><span data-stu-id="d07c2-303">The application should be stored in a Git-based repository.</span></span> <span data-ttu-id="d07c2-304">In caso di nuove distribuzioni, di modifiche dell'applicazione o di scenari di ripristino di emergenza, è più facile usare Azure Pipelines.</span><span class="sxs-lookup"><span data-stu-id="d07c2-304">Whenever there's a new deployment, changes to the application, or disaster recovery, it can be easily deployed using Azure Pipelines.</span></span>

<span data-ttu-id="d07c2-305">**Dati**</span><span class="sxs-lookup"><span data-stu-id="d07c2-305">**Data**</span></span>

<span data-ttu-id="d07c2-306">I dati rappresentano il fattore più importante da considerare nella progettazione di applicazioni.</span><span class="sxs-lookup"><span data-stu-id="d07c2-306">Data is the most important consideration in most application designs.</span></span> <span data-ttu-id="d07c2-307">I dati devono rimanere sincronizzati tra le diverse istanze dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="d07c2-307">Application data must stay in sync between the different instances of the application.</span></span> <span data-ttu-id="d07c2-308">È anche necessario definire una strategia di backup e ripristino di emergenza in caso di interruzione del servizio.</span><span class="sxs-lookup"><span data-stu-id="d07c2-308">Data also needs a backup and disaster recovery strategy if there's an outage.</span></span>

<span data-ttu-id="d07c2-309">Questa progettazione dipende in larga misura da scelte tecnologiche.</span><span class="sxs-lookup"><span data-stu-id="d07c2-309">Achieving this design depends heavily on technology choices.</span></span> <span data-ttu-id="d07c2-310">Ecco alcuni esempi di soluzioni per l'implementazione di un database in modalità a disponibilità elevata nell'hub di Azure Stack:</span><span class="sxs-lookup"><span data-stu-id="d07c2-310">Here are some solution examples for implementing a database in a highly available fashion on Azure Stack Hub:</span></span>

- [<span data-ttu-id="d07c2-311">Distribuire un gruppo di disponibilità di SQL Server 2016 in Azure e nell'hub di Azure Stack</span><span class="sxs-lookup"><span data-stu-id="d07c2-311">Deploy a SQL Server 2016 availability group to Azure and Azure Stack Hub</span></span>](/azure-stack/hybrid/solution-deployment-guide-sql-ha)
- [<span data-ttu-id="d07c2-312">Distribuire una soluzione MongoDB a disponibilità elevata in Azure e nell'hub di Azure Stack</span><span class="sxs-lookup"><span data-stu-id="d07c2-312">Deploy a highly available MongoDB solution to Azure and Azure Stack Hub</span></span>](/azure-stack/hybrid/solution-deployment-guide-mongodb-ha)

<span data-ttu-id="d07c2-313">Se i dati risiedono in più località, la scelta di una soluzione resiliente e a disponibilità elevata implica aspetti ancora più complessi da considerare.</span><span class="sxs-lookup"><span data-stu-id="d07c2-313">Considerations when working with data across multiple locations is an even more complex consideration for a highly available and resilient solution.</span></span> <span data-ttu-id="d07c2-314">Tenere in considerazione:</span><span class="sxs-lookup"><span data-stu-id="d07c2-314">Consider:</span></span>

- <span data-ttu-id="d07c2-315">Latenza e connettività di rete tra hub di Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="d07c2-315">Latency and network connectivity between Azure Stack Hubs.</span></span>
- <span data-ttu-id="d07c2-316">Disponibilità di identità per servizi e autorizzazioni.</span><span class="sxs-lookup"><span data-stu-id="d07c2-316">Availability of identities for services and permissions.</span></span> <span data-ttu-id="d07c2-317">Ogni istanza dell'hub di Azure Stack integra una directory esterna.</span><span class="sxs-lookup"><span data-stu-id="d07c2-317">Each Azure Stack Hub instance integrates with an external directory.</span></span> <span data-ttu-id="d07c2-318">Durante la distribuzione, si sceglie se usare Azure Active Directory (Azure AD) o Active Directory Federation Services (ADFS).</span><span class="sxs-lookup"><span data-stu-id="d07c2-318">During deployment, you choose to use either Azure Active Directory (Azure AD) or Active Directory Federation Services (ADFS).</span></span> <span data-ttu-id="d07c2-319">Di conseguenza, è possibile usare una singola identità in grado di interagire con più istanze indipendenti dell'hub di Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="d07c2-319">As such, there's potential to use a single identity that can interact with multiple independent Azure Stack Hub instances.</span></span>

## <a name="business-continuity-and-disaster-recovery"></a><span data-ttu-id="d07c2-320">Continuità aziendale e ripristino di emergenza</span><span class="sxs-lookup"><span data-stu-id="d07c2-320">Business continuity and disaster recovery</span></span>

<span data-ttu-id="d07c2-321">La continuità aziendale e il ripristino di emergenza sono aspetti importanti sia nell'hub di Azure Stack che in Azure.</span><span class="sxs-lookup"><span data-stu-id="d07c2-321">Business continuity and disaster recovery (BCDR) is an important topic in both Azure Stack Hub and Azure.</span></span> <span data-ttu-id="d07c2-322">La differenza principale consiste nel fatto che nell'hub di Azure Stack l'operatore deve gestire l'intero processo di continuità aziendale e ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="d07c2-322">The main difference is that in Azure Stack Hub, the operator must manage the whole BCDR process.</span></span> <span data-ttu-id="d07c2-323">In Azure parti di questo processo vengono gestite automaticamente da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="d07c2-323">In Azure, parts of BCDR are automatically managed by Microsoft.</span></span>

<span data-ttu-id="d07c2-324">Il processo di continuità aziendale e ripristino di emergenza influisce sulle stesse aree citate nella precedente sezione [Considerazioni su dati e archiviazione](#data-and-storage-considerations):</span><span class="sxs-lookup"><span data-stu-id="d07c2-324">BCDR affects the same areas mentioned in the previous section [Data and storage considerations](#data-and-storage-considerations):</span></span>

- <span data-ttu-id="d07c2-325">Infrastruttura/configurazione</span><span class="sxs-lookup"><span data-stu-id="d07c2-325">Infrastructure / Configuration</span></span>
- <span data-ttu-id="d07c2-326">Disponibilità dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="d07c2-326">Application Availability</span></span>
- <span data-ttu-id="d07c2-327">Dati applicazione</span><span class="sxs-lookup"><span data-stu-id="d07c2-327">Application Data</span></span>

<span data-ttu-id="d07c2-328">Come indicato nella sezione precedente, queste aree sono di responsabilità dell'operatore dell'hub di Azure Stack e possono variare da un'organizzazione all'altra.</span><span class="sxs-lookup"><span data-stu-id="d07c2-328">And as mentioned in the previous section, these areas are the responsibility of the Azure Stack Hub operator and can vary between organizations.</span></span> <span data-ttu-id="d07c2-329">Pianificare la continuità aziendale e il ripristino di emergenza in base agli strumenti e ai processi disponibili.</span><span class="sxs-lookup"><span data-stu-id="d07c2-329">Plan BCDR according to your available tools and processes.</span></span>

<span data-ttu-id="d07c2-330">**Infrastruttura e configurazione**</span><span class="sxs-lookup"><span data-stu-id="d07c2-330">**Infrastructure and configuration**</span></span>

<span data-ttu-id="d07c2-331">Questa sezione descrive l'infrastruttura fisica e logica e la configurazione dell'hub di Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="d07c2-331">This section covers the physical and logical infrastructure and the configuration of Azure Stack Hub.</span></span> <span data-ttu-id="d07c2-332">Riguarda le azioni da eseguire negli ambiti di amministrazione e tenant.</span><span class="sxs-lookup"><span data-stu-id="d07c2-332">It covers actions in the admin and the tenant spaces.</span></span>

<span data-ttu-id="d07c2-333">L'operatore o l'amministratore dell'hub di Azure Stack è responsabile della manutenzione delle istanze dell'hub di Azure Stack,</span><span class="sxs-lookup"><span data-stu-id="d07c2-333">The Azure Stack Hub operator (or administrator) is responsible for maintenance of the Azure Stack Hub instances.</span></span> <span data-ttu-id="d07c2-334">inclusi componenti come rete, archiviazione, identità e altri che esulano dall'ambito di questo articolo.</span><span class="sxs-lookup"><span data-stu-id="d07c2-334">Including components such as the network, storage, identity, and other topics that are outside the scope of this article.</span></span> <span data-ttu-id="d07c2-335">Per altre informazioni sulle specifiche delle operazioni dell'hub di Azure Stack, vedere le risorse seguenti:</span><span class="sxs-lookup"><span data-stu-id="d07c2-335">To learn more about the specifics of Azure Stack Hub operations, see the following resources:</span></span>

- [<span data-ttu-id="d07c2-336">Recuperare i dati nell'hub di Azure Stack con il servizio Backup infrastruttura</span><span class="sxs-lookup"><span data-stu-id="d07c2-336">Recover data in Azure Stack Hub with the Infrastructure Backup Service</span></span>](/azure-stack/operator/azure-stack-backup-infrastructure-backup)
- [<span data-ttu-id="d07c2-337">Abilitare il backup per l'hub di Azure Stack nel portale dell'amministratore</span><span class="sxs-lookup"><span data-stu-id="d07c2-337">Enable backup for Azure Stack Hub from the administrator portal</span></span>](/azure-stack/operator/azure-stack-backup-enable-backup-console)
- [<span data-ttu-id="d07c2-338">Eseguire il ripristino da una grave perdita di dati</span><span class="sxs-lookup"><span data-stu-id="d07c2-338">Recover from catastrophic data loss</span></span>](/azure-stack/operator/azure-stack-backup-recover-data)
- [<span data-ttu-id="d07c2-339">Procedure consigliate per il servizio Backup infrastruttura</span><span class="sxs-lookup"><span data-stu-id="d07c2-339">Infrastructure Backup Service best practices</span></span>](/azure-stack/operator/azure-stack-backup-best-practices)

<span data-ttu-id="d07c2-340">L'hub di Azure Stack rappresenta la piattaforma e l'infrastruttura in cui verranno distribuite le applicazioni Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="d07c2-340">Azure Stack Hub is the platform and fabric on which Kubernetes applications will be deployed.</span></span> <span data-ttu-id="d07c2-341">Il proprietario dell'applicazione Kubernetes sarà un utente dell'hub di Azure Stack, con accesso concesso per distribuire l'infrastruttura dell'applicazione necessaria per la soluzione.</span><span class="sxs-lookup"><span data-stu-id="d07c2-341">The application owner for the Kubernetes application will be a user of Azure Stack Hub, with access granted to deploy the application infrastructure needed for the solution.</span></span> <span data-ttu-id="d07c2-342">In questo caso l'infrastruttura dell'applicazione indica il cluster Kubernetes, distribuito usando il motore del servizio Azure Kubernetes e i servizi circostanti.</span><span class="sxs-lookup"><span data-stu-id="d07c2-342">Application infrastructure in this case means the Kubernetes cluster, deployed using AKS Engine, and the surrounding services.</span></span> <span data-ttu-id="d07c2-343">Questi componenti verranno distribuiti nell'hub di Azure Stack, vincolati da un'offerta dell'hub di Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="d07c2-343">These components will be deployed into Azure Stack Hub, constrained by an Azure Stack Hub offer.</span></span> <span data-ttu-id="d07c2-344">Assicurarsi che l'offerta accettata dal proprietario dell'applicazione Kubernetes abbia la capacità sufficiente (espressa in quote dell'hub di Azure Stack) per distribuire l'intera soluzione.</span><span class="sxs-lookup"><span data-stu-id="d07c2-344">Make sure the offer accepted by the Kubernetes application owner has sufficient capacity (expressed in Azure Stack Hub quotas) to deploy the entire solution.</span></span> <span data-ttu-id="d07c2-345">Come consigliato nella sezione precedente, la distribuzione dell'applicazione deve essere automatizzata tramite Infrastructure-as-Code e pipeline di distribuzione come Azure DevOps Azure Pipelines.</span><span class="sxs-lookup"><span data-stu-id="d07c2-345">As recommended in the previous section, the application deployment should be automated using Infrastructure-as-Code and deployment pipelines like Azure DevOps Azure Pipelines.</span></span>

<span data-ttu-id="d07c2-346">Per altre informazioni sulle offerte e sulle quote dell'hub di Azure Stack, vedere [Panoramica di servizi, piani, offerte e sottoscrizioni dell'hub di Azure Stack](/azure-stack/operator/service-plan-offer-subscription-overview)</span><span class="sxs-lookup"><span data-stu-id="d07c2-346">For more information on Azure Stack Hub offers and quotas, see [Azure Stack Hub services, plans, offers, and subscriptions overview](/azure-stack/operator/service-plan-offer-subscription-overview)</span></span>

<span data-ttu-id="d07c2-347">È importante salvare e archiviare in modo sicuro la configurazione del motore del servizio Azure Kubernetes, inclusi i relativi output.</span><span class="sxs-lookup"><span data-stu-id="d07c2-347">It's important to securely save and store the AKS Engine configuration including its outputs.</span></span> <span data-ttu-id="d07c2-348">Questi file contengono informazioni riservate usate per accedere al cluster Kubernetes, pertanto è necessario proteggerli dall'esposizione ai non amministratori.</span><span class="sxs-lookup"><span data-stu-id="d07c2-348">These files contain confidential information used to access the Kubernetes cluster, so it must be protected from being exposed to non-administrators.</span></span>

<span data-ttu-id="d07c2-349">**Disponibilità dell'applicazione**</span><span class="sxs-lookup"><span data-stu-id="d07c2-349">**Application availability**</span></span>

<span data-ttu-id="d07c2-350">L'applicazione non deve basarsi sui backup di un'istanza distribuita.</span><span class="sxs-lookup"><span data-stu-id="d07c2-350">The application shouldn't rely on backups of a deployed instance.</span></span> <span data-ttu-id="d07c2-351">Come procedura standard, ridistribuire completamente l'applicazione seguendo i modelli di Infrastructure-as-Code.</span><span class="sxs-lookup"><span data-stu-id="d07c2-351">As a standard practice, redeploy the application completely following Infrastructure-as-Code patterns.</span></span> <span data-ttu-id="d07c2-352">Ad esempio, ridistribuirla con Azure DevOps o Azure Pipelines.</span><span class="sxs-lookup"><span data-stu-id="d07c2-352">For example, redeploy using Azure DevOps Azure Pipelines.</span></span> <span data-ttu-id="d07c2-353">La procedura di continuità aziendale e ripristino di emergenza deve implicare la ridistribuzione dell'applicazione nello stesso cluster Kubernetes o in un altro.</span><span class="sxs-lookup"><span data-stu-id="d07c2-353">The BCDR procedure should involve the redeployment of the application to the same or another Kubernetes cluster.</span></span>

<span data-ttu-id="d07c2-354">**Dati dell'applicazione**</span><span class="sxs-lookup"><span data-stu-id="d07c2-354">**Application data**</span></span>

<span data-ttu-id="d07c2-355">È particolarmente importante ridurre al minimo la perdita di dati dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="d07c2-355">Application data is the critical part to minimize data loss.</span></span> <span data-ttu-id="d07c2-356">Nella sezione precedente sono state descritte le tecniche per replicare e sincronizzare i dati tra due o più istanze dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="d07c2-356">In the previous section, techniques to replicate and synchronize data between two (or more) instances of the application were described.</span></span> <span data-ttu-id="d07c2-357">A seconda dell'infrastruttura di database (MySQL, MongoDB, MSSQL o altri) usata per archiviare i dati, saranno disponibili diverse tecniche di disponibilità e backup del database tra cui scegliere.</span><span class="sxs-lookup"><span data-stu-id="d07c2-357">Depending on the database infrastructure (MySQL, MongoDB, MSSQL or others) used to store the data, there will be different database availability and backup techniques available to choose from.</span></span>

<span data-ttu-id="d07c2-358">Per ottenere l'integrità è consigliabile usare:</span><span class="sxs-lookup"><span data-stu-id="d07c2-358">The recommended ways to achieve integrity are to use either:</span></span>
- <span data-ttu-id="d07c2-359">Una soluzione di backup nativa per il database specifico.</span><span class="sxs-lookup"><span data-stu-id="d07c2-359">A native backup solution for the specific database.</span></span>
- <span data-ttu-id="d07c2-360">Una soluzione di backup che supporta ufficialmente il backup e il ripristino del tipo di database usato dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="d07c2-360">A backup solution that officially supports backup and recovery of the database type used by your application.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="d07c2-361">Non archiviare i dati di backup nella stessa istanza dell'hub di Azure Stack in cui risiedono i dati dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="d07c2-361">Do not store your backup data on the same Azure Stack Hub instance where your application data resides.</span></span> <span data-ttu-id="d07c2-362">Un'interruzione completa dell'istanza dell'hub di Azure Stack comprometterebbe anche i backup.</span><span class="sxs-lookup"><span data-stu-id="d07c2-362">A complete outage of the Azure Stack Hub instance would also compromise your backups.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="d07c2-363">Considerazioni sulla disponibilità</span><span class="sxs-lookup"><span data-stu-id="d07c2-363">Availability considerations</span></span>

<span data-ttu-id="d07c2-364">Kubernetes nell'hub di Azure Stack distribuito tramite il motore del servizio Azure Kubernetes non è un servizio gestito.</span><span class="sxs-lookup"><span data-stu-id="d07c2-364">Kubernetes on Azure Stack Hub deployed via AKS Engine isn't a managed service.</span></span> <span data-ttu-id="d07c2-365">Si tratta di una procedura automatizzata di distribuzione e configurazione di un cluster Kubernetes tramite infrastruttura distribuita come servizio (IaaS) di Azure.</span><span class="sxs-lookup"><span data-stu-id="d07c2-365">It's an automated deployment and configuration of a Kubernetes cluster using Azure Infrastructure-as-a-Service (IaaS).</span></span> <span data-ttu-id="d07c2-366">Di conseguenza, fornisce la stessa disponibilità dell'infrastruttura sottostante.</span><span class="sxs-lookup"><span data-stu-id="d07c2-366">As such, it provides the same availability as the underlying infrastructure.</span></span>

<span data-ttu-id="d07c2-367">L'infrastruttura dell'hub di Azure Stack è già resiliente agli errori e fornisce funzionalità come i set di disponibilità per distribuire i componenti in più [domini di errore e di aggiornamento](/azure-stack/user/azure-stack-vm-considerations#high-availability).</span><span class="sxs-lookup"><span data-stu-id="d07c2-367">Azure Stack Hub infrastructure is already resilient to failures, and provides capabilities like Availability Sets to distribute components across multiple [fault and update domains](/azure-stack/user/azure-stack-vm-considerations#high-availability).</span></span> <span data-ttu-id="d07c2-368">Tuttavia, la tecnologia sottostante (clustering di failover) può comunque comportare tempi di inattività per le VM in un server fisico interessato, in caso di errore hardware.</span><span class="sxs-lookup"><span data-stu-id="d07c2-368">But the underlying technology (failover clustering) still incurs some downtime for VMs on an impacted physical server, if there's a hardware failure.</span></span>

<span data-ttu-id="d07c2-369">È consigliabile distribuire il cluster Kubernetes di produzione e il carico di lavoro in due o più cluster.</span><span class="sxs-lookup"><span data-stu-id="d07c2-369">It's a good practice to deploy your production Kubernetes cluster as well as the workload to two (or more) clusters.</span></span> <span data-ttu-id="d07c2-370">Questi cluster devono essere ospitati in località o data center diversi e devono usare tecnologie come Gestione traffico di Azure per instradare gli utenti in base al tempo di risposta del cluster o all'area geografica.</span><span class="sxs-lookup"><span data-stu-id="d07c2-370">These clusters should be hosted in different locations or datacenters, and use technologies like Azure Traffic Manager to route users based on cluster response time or based on geography.</span></span>

![Uso di Gestione traffico per controllare i flussi di traffico](media/pattern-highly-available-kubernetes/aks-azure-traffic-manager.png)

<span data-ttu-id="d07c2-372">I clienti con un singolo cluster Kubernetes in genere si connettono all'indirizzo IP del servizio o al nome DNS di una determinata applicazione.</span><span class="sxs-lookup"><span data-stu-id="d07c2-372">Customers who have a single Kubernetes cluster typically connect to the service IP or DNS name of a given application.</span></span> <span data-ttu-id="d07c2-373">Nelle distribuzioni con più cluster, i clienti dovrebbero connettersi a un nome DNS di Gestione traffico che punta ai servizi/in ingresso in ogni cluster Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="d07c2-373">In a multi-cluster deployment, customers should connect to a Traffic Manager DNS name that points to the services/ingress on each Kubernetes cluster.</span></span>

![Uso di Gestione traffico per il routing a un cluster locale](media/pattern-highly-available-kubernetes/aks-azure-traffic-manager-on-premises.png)

> [!NOTE]
> <span data-ttu-id="d07c2-375">Questo modello è anche una [procedura consigliata per i cluster del servizio Azure Kubernetes (gestiti) in Azure](/azure/aks/operator-best-practices-multi-region#plan-for-multiregion-deployment).</span><span class="sxs-lookup"><span data-stu-id="d07c2-375">This pattern is also a [best practice for (managed) AKS clusters in Azure](/azure/aks/operator-best-practices-multi-region#plan-for-multiregion-deployment).</span></span>

<span data-ttu-id="d07c2-376">Il cluster Kubernetes stesso, distribuito tramite il motore del servizio Azure Kubernetes, deve essere costituito da almeno tre nodi master e due nodi di lavoro.</span><span class="sxs-lookup"><span data-stu-id="d07c2-376">The Kubernetes cluster itself, deployed via AKS Engine, should consist of at least three master nodes and two worker nodes.</span></span>

## <a name="identity-and-security-considerations"></a><span data-ttu-id="d07c2-377">Considerazioni su identità e sicurezza</span><span class="sxs-lookup"><span data-stu-id="d07c2-377">Identity and security considerations</span></span>

<span data-ttu-id="d07c2-378">Identità e sicurezza sono aspetti importanti,</span><span class="sxs-lookup"><span data-stu-id="d07c2-378">Identity and security are important topics.</span></span> <span data-ttu-id="d07c2-379">in particolare quando la soluzione si estende in istanze indipendenti dell'hub di Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="d07c2-379">Especially when the solution spans independent Azure Stack Hub instances.</span></span> <span data-ttu-id="d07c2-380">Kubernetes e Azure (incluso l'hub di Azure Stack) includono meccanismi distinti per il controllo degli accessi in base al ruolo:</span><span class="sxs-lookup"><span data-stu-id="d07c2-380">Kubernetes and Azure (including Azure Stack Hub) both have distinct mechanisms for role-based access control (RBAC):</span></span>

- <span data-ttu-id="d07c2-381">Il controllo degli accessi in base al ruolo di Azure controlla l'accesso alle risorse di Azure (e all'hub di Azure Stack), inclusa la possibilità di creare nuove risorse di Azure.</span><span class="sxs-lookup"><span data-stu-id="d07c2-381">Azure RBAC controls access to resources in Azure (and Azure Stack Hub), including the ability to create new Azure resources.</span></span> <span data-ttu-id="d07c2-382">Questi ruoli possono essere assegnati a utenti, gruppi o entità servizio</span><span class="sxs-lookup"><span data-stu-id="d07c2-382">Permissions can be assigned to users, groups, or service principals.</span></span> <span data-ttu-id="d07c2-383">(un'entità servizio è un'identità di sicurezza usata dalle applicazioni).</span><span class="sxs-lookup"><span data-stu-id="d07c2-383">(A service principal is a security identity used by applications.)</span></span>
- <span data-ttu-id="d07c2-384">I controlli degli accessi in base al ruolo di Kubernetes consentoni di controllare le autorizzazioni per l'API di Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="d07c2-384">Kubernetes RBAC controls permissions to the Kubernetes API.</span></span> <span data-ttu-id="d07c2-385">Ad esempio, la creazione e inserzione dei pod sono azioni che possono essere autorizzate (o negate) a un utente tramite controlli degli accessi in base al ruolo.</span><span class="sxs-lookup"><span data-stu-id="d07c2-385">For example, creating pods and listing pods are actions that can be authorized (or denied) to a user through RBAC.</span></span> <span data-ttu-id="d07c2-386">Per assegnare le autorizzazioni di Kubernetes agli utenti, creare ruoli e binding di ruoli.</span><span class="sxs-lookup"><span data-stu-id="d07c2-386">To assign Kubernetes permissions to users, you create roles and role bindings.</span></span>

<span data-ttu-id="d07c2-387">**Identità dell'hub di Azure Stack e controllo degli accessi in base al ruolo**</span><span class="sxs-lookup"><span data-stu-id="d07c2-387">**Azure Stack Hub identity and RBAC**</span></span>

<span data-ttu-id="d07c2-388">L'hub di Azure Stack prevede due opzioni per il provider di identità.</span><span class="sxs-lookup"><span data-stu-id="d07c2-388">Azure Stack Hub provides two identity provider choices.</span></span> <span data-ttu-id="d07c2-389">Il provider che si usa varia in base al tipo di ambiente e al fatto che sia connesso o disconnesso:</span><span class="sxs-lookup"><span data-stu-id="d07c2-389">The provider you use depends on the environment and whether running in a connected or disconnected environment:</span></span>

- <span data-ttu-id="d07c2-390">Azure AD può essere usato solo in un ambiente connesso.</span><span class="sxs-lookup"><span data-stu-id="d07c2-390">Azure AD - can only be used in a connected environment.</span></span>
- <span data-ttu-id="d07c2-391">ADFS in una foresta di Active Directory tradizionale può essere usato in un ambiente connesso o disconnesso.</span><span class="sxs-lookup"><span data-stu-id="d07c2-391">ADFS to a traditional Active Directory forest - can be used in both a connected or disconnected environment.</span></span>

<span data-ttu-id="d07c2-392">Il provider di identità gestisce utenti e gruppi, tra cui l'autenticazione e l'autorizzazione per l'accesso alle risorse.</span><span class="sxs-lookup"><span data-stu-id="d07c2-392">The identity provider manages users and groups, including authentication and authorization for accessing resources.</span></span> <span data-ttu-id="d07c2-393">L'accesso può essere concesso a risorse dell'hub di Azure Stack, ad esempio sottoscrizioni o gruppi di risorse, e a singole risorse come VM o servizi di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="d07c2-393">Access can be granted to Azure Stack Hub resources like subscriptions, resource groups, and individual resources like VMs or load balancers.</span></span> <span data-ttu-id="d07c2-394">Per un modello di accesso coerente, è consigliabile usare gli stessi gruppi, sia diretti che annidati, per tutti gli hub di Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="d07c2-394">To have a consistent access model, you should consider using the same groups (either direct or nested) for all Azure Stack Hubs.</span></span> <span data-ttu-id="d07c2-395">Ecco un esempio di configurazione:</span><span class="sxs-lookup"><span data-stu-id="d07c2-395">Here's a configuration example:</span></span>

![Gruppi di AAD annidati con l'hub di Azure Stack](media/pattern-highly-available-kubernetes/azure-stack-azure-ad-nested-groups.png)

<span data-ttu-id="d07c2-397">L'esempio contiene un gruppo dedicato (che usa AAD o ADFS) per uno scopo specifico,</span><span class="sxs-lookup"><span data-stu-id="d07c2-397">The example contains a dedicated group (using AAD or ADFS) for a specific purpose.</span></span> <span data-ttu-id="d07c2-398">ad esempio per fornire le autorizzazioni di collaboratore per il gruppo di risorse che contiene l'infrastruttura del cluster Kubernetes in una specifica istanza dell'hub di Azure Stack (in questo caso "Seattle K8s Cluster Contributor").</span><span class="sxs-lookup"><span data-stu-id="d07c2-398">For example, to provide Contributor permissions for the Resource Group that contains our Kubernetes cluster infrastructure on a specific Azure Stack Hub instance (here "Seattle K8s Cluster Contributor").</span></span> <span data-ttu-id="d07c2-399">Questi gruppi vengono quindi annidati in un gruppo generale che contiene i sottogruppi per ogni hub di Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="d07c2-399">These groups are then nested into an overall group that contains the "subgroups" for each Azure Stack Hub.</span></span>

<span data-ttu-id="d07c2-400">L'utente di esempio avrà ora le autorizzazioni collaboratore per entrambi i gruppi di risorse che contengono l'intero set di risorse dell'infrastruttura Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="d07c2-400">Our sample user will now have "Contributor" permissions to both Resources Groups that contain the entire set of Kubernetes infrastructure resources.</span></span> <span data-ttu-id="d07c2-401">L'utente avrà accesso alle risorse in entrambe le istanze dell'hub di Azure Stack, perché tali istanze condividono lo stesso provider di identità.</span><span class="sxs-lookup"><span data-stu-id="d07c2-401">The user will have access to resources on both Azure Stack Hub instances, because the instances share the same identity provider.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="d07c2-402">Queste autorizzazioni hanno effetto solo sull'hub di Azure Stack e su alcune risorse distribuite insieme.</span><span class="sxs-lookup"><span data-stu-id="d07c2-402">These permissions affect only Azure Stack Hub and some of the resources deployed on top of it.</span></span> <span data-ttu-id="d07c2-403">Un utente con questo livello di accesso può provocare danni enormi, ma non può accedere alle VM IaaS di Kubernetes né all'API Kubernetes senza ulteriori autorizzazioni di accesso alla distribuzione di Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="d07c2-403">A user who has this level of access can do a lot of harm, but cannot access the Kubernetes IaaS VMs nor the Kubernetes API without additional access to the Kubernetes deployment.</span></span>

<span data-ttu-id="d07c2-404">**Identità di Kubernetes e controllo dell'accesso in base al ruolo**</span><span class="sxs-lookup"><span data-stu-id="d07c2-404">**Kubernetes identity and RBAC**</span></span>

<span data-ttu-id="d07c2-405">Per impostazione predefinita, un cluster Kubernetes non usa lo stesso provider di identità dell'hub di Azure Stack sottostante.</span><span class="sxs-lookup"><span data-stu-id="d07c2-405">A Kubernetes cluster, by default, doesn't use the same Identity Provider as the underlaying Azure Stack Hub.</span></span> <span data-ttu-id="d07c2-406">Le VM che ospitano il cluster Kubernetes, i nodi master e i ruoli di lavoro usano la chiave SSH specificata durante la distribuzione del cluster.</span><span class="sxs-lookup"><span data-stu-id="d07c2-406">The VMs hosting the Kubernetes cluster, the master, and worker nodes, use the SSH Key that is specified during the deployment of the cluster.</span></span> <span data-ttu-id="d07c2-407">Questa chiave SSH è necessaria per connettersi a questi nodi tramite SSH.</span><span class="sxs-lookup"><span data-stu-id="d07c2-407">This SSH key is required to connect to these nodes using SSH.</span></span>

<span data-ttu-id="d07c2-408">L'API Kubernetes (ad esempio accessibile tramite `kubectl`) è protetta anche dagli account del servizio, incluso un account di amministratore del cluster predefinito.</span><span class="sxs-lookup"><span data-stu-id="d07c2-408">The Kubernetes API (for example, accessed by using `kubectl`) is also protected by service accounts including a default "cluster admin" service account.</span></span> <span data-ttu-id="d07c2-409">Le credenziali per questo account del servizio vengono inizialmente archiviate nel file `.kube/config` nei nodi master di Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="d07c2-409">The credentials for this service account are initially stored in the `.kube/config` file on your Kubernetes master nodes.</span></span>

<span data-ttu-id="d07c2-410">**Gestione dei segreti e credenziali dell'applicazione**</span><span class="sxs-lookup"><span data-stu-id="d07c2-410">**Secrets management and application credentials**</span></span>

<span data-ttu-id="d07c2-411">Per archiviare segreti come le stringhe di connessione o le credenziali del database sono disponibili diverse opzioni, tra cui:</span><span class="sxs-lookup"><span data-stu-id="d07c2-411">To store secrets like connection strings or database credentials there are several choices, including:</span></span>

- <span data-ttu-id="d07c2-412">Insieme di credenziali chiave di Azure</span><span class="sxs-lookup"><span data-stu-id="d07c2-412">Azure Key Vault</span></span>
- <span data-ttu-id="d07c2-413">Segreti di Kubernetes</span><span class="sxs-lookup"><span data-stu-id="d07c2-413">Kubernetes Secrets</span></span>
- <span data-ttu-id="d07c2-414">Soluzioni di terze parti come HashiCorp Vault (in esecuzione in Kubernetes)</span><span class="sxs-lookup"><span data-stu-id="d07c2-414">3rd-Party solutions like HashiCorp Vault (running on Kubernetes)</span></span>

<span data-ttu-id="d07c2-415">Non archiviare segreti o credenziali in testo non crittografato nei file di configurazione, nel codice dell'applicazione o negli script</span><span class="sxs-lookup"><span data-stu-id="d07c2-415">Do not store secrets or credentials in plaintext in your configuration files, application code, or within scripts.</span></span> <span data-ttu-id="d07c2-416">e neanche in un sistema di controllo della versione.</span><span class="sxs-lookup"><span data-stu-id="d07c2-416">And do not store them in a version control system.</span></span> <span data-ttu-id="d07c2-417">L'automazione della distribuzione dovrebbe recuperare i segreti se necessario.</span><span class="sxs-lookup"><span data-stu-id="d07c2-417">Instead, the deployment automation should retrieve the secrets as needed.</span></span>

## <a name="patch-and-update"></a><span data-ttu-id="d07c2-418">Applicazione di patch e aggiornamenti</span><span class="sxs-lookup"><span data-stu-id="d07c2-418">Patch and update</span></span>

<span data-ttu-id="d07c2-419">Il processo di **applicazione di patch e aggiornamenti** nel servizio Azure Kubernetes è parzialmente automatizzato.</span><span class="sxs-lookup"><span data-stu-id="d07c2-419">The **Patch and Update (PNU)** process in Azure Kubernetes Service is partially automated.</span></span> <span data-ttu-id="d07c2-420">Gli aggiornamenti della versione di Kubernetes vengono attivati manualmente, mentre gli aggiornamenti della sicurezza vengono applicati automaticamente.</span><span class="sxs-lookup"><span data-stu-id="d07c2-420">Kubernetes version upgrades are triggered manually, while security updates are applied automatically.</span></span> <span data-ttu-id="d07c2-421">Questi aggiornamenti possono includere correzioni di sicurezza del sistema operativo o aggiornamenti del kernel.</span><span class="sxs-lookup"><span data-stu-id="d07c2-421">These updates can include OS security fixes or kernel updates.</span></span> <span data-ttu-id="d07c2-422">Il servizio Azure Kubernetes non riavvia automaticamente i nodi Linux per completare il processo di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="d07c2-422">AKS doesn't automatically reboot these Linux nodes to complete the update process.</span></span> 

<span data-ttu-id="d07c2-423">Il processo di applicazione di patch e aggiornamenti per un cluster Kubernetes distribuito con il motore del servizio Azure Kubernetes nell'hub di Azure Stack non è gestito ed è di responsabilità dell'operatore del cluster.</span><span class="sxs-lookup"><span data-stu-id="d07c2-423">The PNU process for a Kubernetes cluster deployed using AKS Engine on Azure Stack Hub is unmanaged, and is the responsibility of the cluster operator.</span></span> 

<span data-ttu-id="d07c2-424">Il motore del servizio Azure Kubernetes supporta le due attività più importanti:</span><span class="sxs-lookup"><span data-stu-id="d07c2-424">AKS Engine helps with the two most important tasks:</span></span>

- [<span data-ttu-id="d07c2-425">Aggiornamento a una nuova versione di Kubernetes e dell'immagine del sistema operativo di base</span><span class="sxs-lookup"><span data-stu-id="d07c2-425">Upgrade to a newer Kubernetes and base OS image version</span></span>](/azure-stack/user/azure-stack-kubernetes-aks-engine-upgrade#steps-to-upgrade-to-a-newer-kubernetes-version)
- [<span data-ttu-id="d07c2-426">Aggiornamento della sola immagine del sistema operativo di base</span><span class="sxs-lookup"><span data-stu-id="d07c2-426">Upgrade the base OS image only</span></span>](/azure-stack/user/azure-stack-kubernetes-aks-engine-upgrade#steps-to-only-upgrade-the-os-image)

<span data-ttu-id="d07c2-427">Le nuove immagini del sistema operativo di base contengono gli ultimi aggiornamenti di sicurezza e del kernel.</span><span class="sxs-lookup"><span data-stu-id="d07c2-427">Newer base OS images contain the latest OS security fixes and kernel updates.</span></span> 

<span data-ttu-id="d07c2-428">Il meccanismo di [aggiornamento automatico](https://wiki.debian.org/UnattendedUpgrades) installa automaticamente gli aggiornamenti della sicurezza rilasciati prima che sia disponibile una nuova versione dell'immagine del sistema operativo di base nel marketplace dell'hub di Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="d07c2-428">The [Unattended Upgrade](https://wiki.debian.org/UnattendedUpgrades) mechanism automatically installs security updates that are released before a new base OS image version is available in the Azure Stack Hub Marketplace.</span></span> <span data-ttu-id="d07c2-429">L'aggiornamento automatico è abilitato per impostazione predefinita e installa automaticamente gli aggiornamenti della sicurezza, ma non riavvia i nodi del cluster Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="d07c2-429">Unattended upgrade is enabled by default and installs security updates automatically, but does not reboot the Kubernetes cluster nodes.</span></span> <span data-ttu-id="d07c2-430">Il riavvio dei nodi può essere automatizzato tramite [**K** Ubernetes **RE** boot **D** aemon (kured))](/azure/aks/node-updates-kured).</span><span class="sxs-lookup"><span data-stu-id="d07c2-430">Rebooting the nodes can be automated using the open-source [**K** Ubernetes **RE** boot **D** aemon (kured))](/azure/aks/node-updates-kured).</span></span> <span data-ttu-id="d07c2-431">Kured controlla i nodi Linux che richiedono un riavvio, quindi gestisce automaticamente la ripianificazione del processo di riavvio dei nodi e dei pod in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="d07c2-431">Kured watches for Linux nodes that require a reboot, then automatically handle the rescheduling of running pods and node reboot process.</span></span>

## <a name="deployment-cicd-considerations"></a><span data-ttu-id="d07c2-432">Considerazioni sulla distribuzione (CI/CD)</span><span class="sxs-lookup"><span data-stu-id="d07c2-432">Deployment (CI/CD) considerations</span></span>

<span data-ttu-id="d07c2-433">Azure e l'hub di Azure Stack espongono le stesse API REST di Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="d07c2-433">Azure and Azure Stack Hub expose the same Azure Resource Manager REST APIs.</span></span> <span data-ttu-id="d07c2-434">Queste API vengono gestite come qualsiasi altro cloud di Azure (Azure, Azure China 21Vianet, Azure per enti pubblici).</span><span class="sxs-lookup"><span data-stu-id="d07c2-434">These APIs are addressed like any other Azure cloud (Azure, Azure China 21Vianet, Azure Government).</span></span> <span data-ttu-id="d07c2-435">Potrebbero esserci differenze nelle versioni delle API tra i cloud, e l'hub di Azure Stack fornisce solo un sottoinsieme di servizi.</span><span class="sxs-lookup"><span data-stu-id="d07c2-435">There may be differences in API versions between clouds, and Azure Stack Hub provides only a subset of services.</span></span> <span data-ttu-id="d07c2-436">Anche l'URI dell'endpoint di gestione è diverso per ogni cloud e per ogni istanza dell'hub di Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="d07c2-436">The management endpoint URI is also different for each cloud, and each instance of Azure Stack Hub.</span></span>

<span data-ttu-id="d07c2-437">A parte le differenze minime citate, le API REST di Azure Resource Manager offrono un modo coerente per interagire con Azure e con l'hub di Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="d07c2-437">Aside from the subtle differences mentioned, Azure Resource Manager REST APIs provide a consistent way to interact with both Azure and Azure Stack Hub.</span></span> <span data-ttu-id="d07c2-438">Lo stesso set di strumenti può essere usato in questo caso come in qualsiasi altro cloud di Azure.</span><span class="sxs-lookup"><span data-stu-id="d07c2-438">The same set of tools can be used here as would be used with any other Azure cloud.</span></span> <span data-ttu-id="d07c2-439">Per distribuire e orchestrare i servizi nell'hub di Azure Stack, è possibile usare Azure DevOps, strumenti come Jenkins oppure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="d07c2-439">You can use Azure DevOps, tools like Jenkins, or PowerShell, to deploy and orchestrate services to Azure Stack Hub.</span></span>

<span data-ttu-id="d07c2-440">**Considerazioni**</span><span class="sxs-lookup"><span data-stu-id="d07c2-440">**Considerations**</span></span>

<span data-ttu-id="d07c2-441">Una delle principali differenze per quanto riguarda le distribuzioni dell'hub di Azure Stack è la questione dell'accessibilità a Internet.</span><span class="sxs-lookup"><span data-stu-id="d07c2-441">One of the major differences when it comes to Azure Stack Hub deployments is the question of Internet accessibility.</span></span> <span data-ttu-id="d07c2-442">L'accessibilità a Internet determina se selezionare un agente di compilazione ospitato da Microsoft o self-hosted per i processi CI/CD.</span><span class="sxs-lookup"><span data-stu-id="d07c2-442">Internet accessibility determines whether to select a Microsoft-hosted or a self-hosted build agent for your CI/CD jobs.</span></span>

<span data-ttu-id="d07c2-443">Un agente self-hosted può essere eseguito nell'hub di Azure Stack (come VM IaaS) o in una subnet di rete che può accedere all'hub di Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="d07c2-443">A self-hosted agent can run on top of Azure Stack Hub (as an IaaS VM) or in a network subnet that can access Azure Stack Hub.</span></span> <span data-ttu-id="d07c2-444">Per altre informazioni sulle differenze, vedere [Agenti di Azure Pipelines](/azure/devops/pipelines/agents/agents).</span><span class="sxs-lookup"><span data-stu-id="d07c2-444">Go to [Azure Pipelines agents](/azure/devops/pipelines/agents/agents) to learn more about the differences.</span></span>

<span data-ttu-id="d07c2-445">L'immagine seguente aiuta a decidere se è necessario un agente di compilazione self-hosted o ospitato da Microsoft:</span><span class="sxs-lookup"><span data-stu-id="d07c2-445">The following image helps you to decide if you need a self-hosted or a Microsoft-hosted build agent:</span></span>

![Agenti di compilazione self-hosted - Sì o No](media/pattern-highly-available-kubernetes/aks-on-stack-self-hosted-build-agents-yes-or-no.png)

- <span data-ttu-id="d07c2-447">Gli endpoint di gestione dell'hub di Azure Stack sono accessibili tramite Internet?</span><span class="sxs-lookup"><span data-stu-id="d07c2-447">Are the Azure Stack Hub management endpoints accessible via Internet?</span></span>
  - <span data-ttu-id="d07c2-448">Sì: è possibile usare Azure Pipelines con agenti ospitati da Microsoft per connettersi all'hub di Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="d07c2-448">Yes: We can use Azure Pipelines with Microsoft-hosted agents to connect to Azure Stack Hub.</span></span>
  - <span data-ttu-id="d07c2-449">No: sono necessari agenti self-hosted in grado di connettersi agli endpoint di gestione dell'hub di Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="d07c2-449">No: We need self-hosted agents that can connect to Azure Stack Hub's management endpoints.</span></span>
- <span data-ttu-id="d07c2-450">Il cluster Kubernetes è accessibile tramite Internet?</span><span class="sxs-lookup"><span data-stu-id="d07c2-450">Is our Kubernetes cluster accessible via the Internet?</span></span>
  - <span data-ttu-id="d07c2-451">Sì: è possibile usare Azure Pipelines con agenti ospitati da Microsoft per interagire direttamente con l'endpoint API di Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="d07c2-451">Yes: We can use Azure Pipelines with Microsoft-hosted agents to interact directly with Kubernetes API endpoint.</span></span>
  - <span data-ttu-id="d07c2-452">No: sono necessari agenti self-hosted in grado di connettersi all'endpoint API del cluster Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="d07c2-452">No: We need self-hosted Agents that can connect to the Kubernetes cluster API endpoint.</span></span>

<span data-ttu-id="d07c2-453">Negli scenari in cui gli endpoint di gestione dell'hub di Azure Stack e l'API Kubernetes sono accessibili tramite Internet, per la distribuzione è possibile usare un agente ospitato da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="d07c2-453">In scenarios where the Azure Stack Hub management endpoints and Kubernetes API are accessible via the internet, the deployment can use a Microsoft-hosted agent.</span></span> <span data-ttu-id="d07c2-454">Questa distribuzione genera l'architettura dell'applicazione seguente:</span><span class="sxs-lookup"><span data-stu-id="d07c2-454">This deployment will result in an application architecture as follows:</span></span>

<span data-ttu-id="d07c2-455">[![Panoramica dell'architettura pubblica](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern.png)](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern.png#lightbox)</span><span class="sxs-lookup"><span data-stu-id="d07c2-455">[![Public architecture overview](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern.png)](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern.png#lightbox)</span></span>

<span data-ttu-id="d07c2-456">Se gli endpoint di Azure Resource Manager, l'API Kubernetes o entrambi non sono direttamente accessibili tramite Internet, è possibile usare un agente di compilazione self-hosted per eseguire i passaggi della pipeline.</span><span class="sxs-lookup"><span data-stu-id="d07c2-456">If the Azure Resource Manager endpoints, Kubernetes API, or both aren't directly accessible via the Internet, we can leverage a self-hosted build agent to run the pipeline steps.</span></span> <span data-ttu-id="d07c2-457">Questa architettura richiede meno connettività e può essere distribuita con la sola connettività di rete locale negli endpoint di Azure Resource Manager e nell'API Kubernetes:</span><span class="sxs-lookup"><span data-stu-id="d07c2-457">This design needs less connectivity, and can be deployed with only on-premises network connectivity to Azure Resource Manager endpoints and the Kubernetes API:</span></span>

<span data-ttu-id="d07c2-458">[![Panoramica dell'architettura locale](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern-self-hosted.png)](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern-self-hosted.png#lightbox)</span><span class="sxs-lookup"><span data-stu-id="d07c2-458">[![On-prem architecture overview](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern-self-hosted.png)](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern-self-hosted.png#lightbox)</span></span>

> [!NOTE]
> <span data-ttu-id="d07c2-459">**Informazioni sugli scenari disconnessi**.</span><span class="sxs-lookup"><span data-stu-id="d07c2-459">**What about disconnected scenarios?**</span></span> <span data-ttu-id="d07c2-460">Negli scenari in cui l'hub di Azure Stack, Kubernetes o entrambi non hanno endpoint di gestione con connessione Internet, è comunque possibile usare Azure DevOps per le distribuzioni.</span><span class="sxs-lookup"><span data-stu-id="d07c2-460">In scenarios where either Azure Stack Hub or Kubernetes or both of them do not have internet-facing management endpoints, it is still possible to use Azure DevOps for your deployments.</span></span> <span data-ttu-id="d07c2-461">È possibile usare un pool di agenti self-hosted (ovvero un agente DevOps in esecuzione in locale o nell'hub di Azure Stack) o un istanza di Azure DevOps Server completamente self-hosted in locale.</span><span class="sxs-lookup"><span data-stu-id="d07c2-461">You can either use a self-hosted Agent Pool (which is a DevOps Agent running on-premises or on Azure Stack Hub itself) or a completly self-hosted Azure DevOps Server on-premises.</span></span> <span data-ttu-id="d07c2-462">L'agente self-hosted deve avere solo connettività Internet HTTPS (TCP/443) in uscita.</span><span class="sxs-lookup"><span data-stu-id="d07c2-462">The self-hosted agent needs only outbound HTTPS (TCP/443) Internet connectivity.</span></span>

<span data-ttu-id="d07c2-463">Il modello può usare un cluster Kubernetes (distribuito e orchestrato con il motore del servizio Azure Kubernetes) in ogni istanza dell'hub di Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="d07c2-463">The pattern can use a Kubernetes cluster (deployed and orchestrated with AKS engine) on each Azure Stack Hub instance.</span></span> <span data-ttu-id="d07c2-464">Include un'applicazione costituita da un front-end, un servizio back-end di livello intermedio, ad esempio MongoDB, e un controller in ingresso basato su nginx.</span><span class="sxs-lookup"><span data-stu-id="d07c2-464">It includes an application consisting of a frontend, a mid-tier, backend services (for example MongoDB), and an nginx-based Ingress Controller.</span></span> <span data-ttu-id="d07c2-465">Invece di usare un database ospitato nel cluster K8s, è possibile sfruttare archivi dati esterni.</span><span class="sxs-lookup"><span data-stu-id="d07c2-465">Instead of using a database hosted on the K8s cluster, you can leverage "external data stores".</span></span> <span data-ttu-id="d07c2-466">Le opzioni di database includono MySQL, SQL Server o qualsiasi tipo di database ospitato all'esterno dell'hub di Azure Stack o in IaaS.</span><span class="sxs-lookup"><span data-stu-id="d07c2-466">Database options include MySQL, SQL Server, or any kind of database hosted outside of Azure Stack Hub or in IaaS.</span></span> <span data-ttu-id="d07c2-467">Configurazioni come questa esulano dall'ambito di questo articolo.</span><span class="sxs-lookup"><span data-stu-id="d07c2-467">Configurations like this aren't in scope here.</span></span>

## <a name="partner-solutions"></a><span data-ttu-id="d07c2-468">Soluzioni partner</span><span class="sxs-lookup"><span data-stu-id="d07c2-468">Partner solutions</span></span>

<span data-ttu-id="d07c2-469">Sono disponibili soluzioni dei partner Microsoft che possono estendere le funzionalità dell'hub di Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="d07c2-469">There are Microsoft Partner solutions that can extend the capabilities of Azure Stack Hub.</span></span> <span data-ttu-id="d07c2-470">Queste soluzioni sono risultate utili nelle distribuzioni di applicazioni in esecuzione nei cluster Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="d07c2-470">These solutions have been found useful in deployments of applications running on Kubernetes clusters.</span></span>  

## <a name="storage-and-data-solutions"></a><span data-ttu-id="d07c2-471">Soluzioni di archiviazione e dati</span><span class="sxs-lookup"><span data-stu-id="d07c2-471">Storage and data solutions</span></span>

<span data-ttu-id="d07c2-472">Come descritto nella sezione [Considerazioni su dati e archiviazione](#data-and-storage-considerations), l'hub di Azure Stack attualmente non include una soluzione nativa per replicare l'archiviazione tra più istanze.</span><span class="sxs-lookup"><span data-stu-id="d07c2-472">As described in [Data and storage considerations](#data-and-storage-considerations), Azure Stack Hub currently doesn't have a native solution to replicate storage across multiple instances.</span></span> <span data-ttu-id="d07c2-473">Diversamente da Azure, la funzionalità di replica dell'archiviazione tra più aree non esiste.</span><span class="sxs-lookup"><span data-stu-id="d07c2-473">Unlike Azure, the capability of replicating storage across multiple regions does not exist.</span></span> <span data-ttu-id="d07c2-474">Nell'hub di Azure Stack ogni istanza corrisponde a uno specifico cloud distinto.</span><span class="sxs-lookup"><span data-stu-id="d07c2-474">In Azure Stack Hub, each instance is its own distinct cloud.</span></span> <span data-ttu-id="d07c2-475">Sono tuttavia disponibili soluzioni dei partner Microsoft che consentono la replica dell'archiviazione tra hub di Azure Stack e Azure.</span><span class="sxs-lookup"><span data-stu-id="d07c2-475">However, solutions are available from Microsoft Partners that enable storage replication across Azure Stack Hubs and Azure.</span></span> 

<span data-ttu-id="d07c2-476">**SCALITY**</span><span class="sxs-lookup"><span data-stu-id="d07c2-476">**SCALITY**</span></span>

<span data-ttu-id="d07c2-477">[Scality](https://www.scality.com/) offre archiviazione su scala Web che supporta aziende digitali dal 2009.</span><span class="sxs-lookup"><span data-stu-id="d07c2-477">[Scality](https://www.scality.com/) delivers web-scale storage that has powered digital businesses since 2009.</span></span> <span data-ttu-id="d07c2-478">Scality RING, la soluzione di archiviazione software-defined, trasforma i comuni server x86 in un pool di archiviazione illimitato per qualsiasi tipo di dati (file e oggetto) su scala petabyte.</span><span class="sxs-lookup"><span data-stu-id="d07c2-478">The Scality RING, our software-defined storage, turns commodity x86 servers into an unlimited storage pool for any type of data –file and object– at petabyte scale.</span></span>

<span data-ttu-id="d07c2-479">**CLOUDIAN**</span><span class="sxs-lookup"><span data-stu-id="d07c2-479">**CLOUDIAN**</span></span>

<span data-ttu-id="d07c2-480">[Cloudian](https://www.cloudian.com/) semplifica l'archiviazione aziendale con una soluzione scalabile illimitata che consolida enormi set di dati in un singolo ambiente facilmente gestibile.</span><span class="sxs-lookup"><span data-stu-id="d07c2-480">[Cloudian](https://www.cloudian.com/) simplifies enterprise storage with limitless scalable storage that consolidates massive data sets to a single, easily managed environment.</span></span>

## <a name="next-steps"></a><span data-ttu-id="d07c2-481">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="d07c2-481">Next steps</span></span>

<span data-ttu-id="d07c2-482">Per altre informazioni sui concetti presentati in questo articolo, vedere:</span><span class="sxs-lookup"><span data-stu-id="d07c2-482">To learn more about concepts introduced in this article:</span></span>

- <span data-ttu-id="d07c2-483">[Scalabilità tra cloud](pattern-cross-cloud-scale.md) e [Modelli di app con distribuzione geografica](pattern-geo-distributed.md) nell'hub di Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="d07c2-483">[Cross-cloud scaling](pattern-cross-cloud-scale.md) and [Geo-distributed app patterns](pattern-geo-distributed.md) in Azure Stack Hub.</span></span>
- <span data-ttu-id="d07c2-484">[Architettura di microservizi nel servizio Azure Kubernetes](/azure/architecture/reference-architectures/microservices/aks).</span><span class="sxs-lookup"><span data-stu-id="d07c2-484">[Microservices architecture on Azure Kubernetes Service (AKS)](/azure/architecture/reference-architectures/microservices/aks).</span></span>

<span data-ttu-id="d07c2-485">Quando si è pronti a testare l'esempio di soluzione, continuare con la [guida alla distribuzione del cluster a disponibilità elevata](solution-deployment-guide-highly-available-kubernetes.md).</span><span class="sxs-lookup"><span data-stu-id="d07c2-485">When you're ready to test the solution example, continue with the [High availability Kubernetes cluster deployment guide](solution-deployment-guide-highly-available-kubernetes.md).</span></span> <span data-ttu-id="d07c2-486">Questa guida contiene istruzioni dettagliate per la distribuzione e il test dei componenti.</span><span class="sxs-lookup"><span data-stu-id="d07c2-486">The deployment guide provides step-by-step instructions for deploying and testing its components.</span></span>